

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>webServices.wsGanados.views &mdash; documentación de HatosGanaderos - 1.0</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="top" title="documentación de HatosGanaderos - 1.0" href="../../../index.html"/>
        <link rel="up" title="Código de módulo" href="../../index.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="../../../index.html" class="fa fa-home"> HatosGanaderos</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Instalación.html">Instalación</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../Instalación.html#windows">Windows</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../Instalación.html#linux">Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../Instalación.html#mac">Mac</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../Tutorial 1: Crear Cuentas.html">Tutorial 1: Crear Cuentas</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../Tutorial 1: Crear Cuentas.html#registro">Registro</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../Tutorial 1: Crear Cuentas.html#recuperar-contrasena">Recuperar Contraseña</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../Tutorial 1: Crear Cuentas.html#login">Login</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../Tutorial 1: Crear Cuentas.html#modificar-detalles-de-cuenta">Modificar Detalles de Cuenta</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../Tutorial 1: Crear Cuentas.html#modificar-clave">Modificar Clave</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../Tutorial 1: Crear Cuentas.html#cambiar-correo-electronico">Cambiar Correo Electrónico</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../Tutorial 2: Configuración.html">Tutorial 2: Configuración</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../Tutorial 2: Configuración.html#crear-configuracion-de-la-ganaderia">Crear Configuración de la Ganadería</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../Tutorial 3: Técnicos.html">Tutorial 3: Técnicos</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../Tutorial 3: Técnicos.html#crear-cuentas-de-tecnicos">Crear Cuentas de Técnicos</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../Tutorial 3: Técnicos.html#listar-cuentas-de-tecnicos">Listar Cuentas de Técnicos</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../Tutorial 4: Módulo de Reproducción.html">Tutorial 4: Módulo de Reproducción</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../Tutorial 4: Módulo de Reproducción.html#registrar-ganados">Registrar Ganados</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../Tutorial 4: Módulo de Reproducción.html#listar-ganados">Listar ganados</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../Tutorial 4: Módulo de Reproducción.html#actualizar-datos-del-ganado">Actualizar Datos del Ganado</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../Tutorial 4: Módulo de Reproducción.html#agregar-celo">Agregar Celo</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../Tutorial 4: Módulo de Reproducción.html#agregar-inseminacion-o-monta">Agregar Inseminación o Monta</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../Tutorial 4: Módulo de Reproducción.html#verificacion-de-celo">Verificación de Celo</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../Tutorial 4: Módulo de Reproducción.html#agregar-problemas-de-gestacion">Agregar Problemas de Gestación</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../Tutorial 4: Módulo de Reproducción.html#agregar-gestacion-correcta">Agregar Gestación Correcta</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../Tutorial 4: Módulo de Reproducción.html#registrar-esperma">Registrar Esperma</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../Tutorial 4: Módulo de Reproducción.html#listar-esperma">Listar Esperma</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../Tutorial 4: Módulo de Reproducción.html#actualizar-datos-de-esperma">Actualizar Datos de Esperma</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../Tutorial 5: Módulo de Producción.html">Tutorial 5: Módulo de Producción</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../Tutorial 5: Módulo de Producción.html#listar-ganados-de-produccion">Listar Ganados de Producción</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../Tutorial 5: Módulo de Producción.html#agregar-ordeno">Agregar Ordeño</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../Tutorial 5: Módulo de Producción.html#editar-ordeno-diario">Editar Ordeño Diario</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../Tutorial 6: Módulo de Sanidad.html">Tutorial 6: Módulo de Sanidad</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../Tutorial 6: Módulo de Sanidad.html#agregar-desparasitador">Agregar Desparasitador</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../Tutorial 6: Módulo de Sanidad.html#listar-desparasitador">Listar Desparasitador</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../Tutorial 6: Módulo de Sanidad.html#actualizar-datos-del-desparasitador">Actualizar Datos del Desparasitador</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../Tutorial 6: Módulo de Sanidad.html#asignar-desparasitador-a-ganados">Asignar Desparasitador a Ganados</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../Tutorial 6: Módulo de Sanidad.html#agregar-vacuna">Agregar Vacuna</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../Tutorial 6: Módulo de Sanidad.html#listar-vacuna">Listar Vacuna</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../Tutorial 6: Módulo de Sanidad.html#actualizar-datos-de-la-vacuna">Actualizar Datos de la Vacuna</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../Tutorial 6: Módulo de Sanidad.html#asignar-vacuna-a-ganados">Asignar Vacuna a Ganados</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../Tutorial 7: Módulo de Alimentación.html">Tutorial 7: Módulo de Alimentación</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../Tutorial 7: Módulo de Alimentación.html#agregar-alimento">Agregar Alimento</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../Tutorial 7: Módulo de Alimentación.html#actualizar-alimento">Actualizar Alimento</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../Tutorial 7: Módulo de Alimentación.html#asignar-el-alimento-al-ganado">Asignar el Alimento al Ganado</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../Tutorial 8: Mensajería.html">Tutorial 8: Mensajería</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../Tutorial 8: Mensajería.html#enviar-mensajes">Enviar Mensajes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../Tutorial 8: Mensajería.html#leer-mensajes">Leer Mensajes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../Tutorial 9: Reportes.html">Tutorial 9: Reportes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../Tutorial 9: Reportes.html#generar-un-reporte">Generar un Reporte</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../Tutorial 10: Notificaciones.html">Tutorial 10: Notificaciones</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../Tutorial 10: Notificaciones.html#gestionar-notificaciones">Gestionar Notificaciones</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../SIDGV.html">Módulo SIDGV</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../SIDGV.html#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SIDGV.html#module-SIDGV.settings">SIDGV.settings module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SIDGV.html#sidgv-settings-dotcloud-module">SIDGV.settings_dotcloud module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SIDGV.html#module-SIDGV.urls">SIDGV.urls module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SIDGV.html#module-SIDGV.wsgi">SIDGV.wsgi module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../SIDGV.html#module-SIDGV">Module contents</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../alimentos.html">Módulo de Alimentos</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../alimentos.html#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../alimentos.html#module-alimentos.admin">alimentos.admin module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../alimentos.html#module-alimentos.forms">alimentos.forms module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../alimentos.html#module-alimentos.models">alimentos.models module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../alimentos.html#module-alimentos.tests">alimentos.tests module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../alimentos.html#module-alimentos.views">alimentos.views module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../alimentos.html#module-alimentos">Module contents</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../ganados.html">Módulo de Ganados</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../ganados.html#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../ganados.html#module-ganados.admin">ganados.admin module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../ganados.html#module-ganados.forms">ganados.forms module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../ganados.html#ganados-models-module">ganados.models module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../ganados.html#module-ganados.tests">ganados.tests module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../ganados.html#module-ganados.views">ganados.views module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../ganados.html#module-ganados">Module contents</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../medicament.html">Módulo de Medicamentos</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../medicament.html#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../medicament.html#module-medicament.admin">medicament.admin module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../medicament.html#module-medicament.forms">medicament.forms module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../medicament.html#module-medicament.models">medicament.models module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../medicament.html#module-medicament.tests">medicament.tests module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../medicament.html#module-medicament.views">medicament.views module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../medicament.html#module-medicament">Module contents</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../messages.html">Módulo de Mensajería</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../messages.html#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../messages.html#module-messages.admin">messages.admin module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../messages.html#module-messages.forms">messages.forms module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../messages.html#module-messages.models">messages.models module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../messages.html#module-messages.tests">messages.tests module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../messages.html#module-messages.views">messages.views module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../messages.html#module-messages">Module contents</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../notifications.html">Módulo de Notificaciones</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../notifications.html#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../notifications.html#module-notifications.admin">notifications.admin module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../notifications.html#module-notifications.models">notifications.models module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../notifications.html#module-notifications.tests">notifications.tests module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../notifications.html#module-notifications.views">notifications.views module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../notifications.html#module-notifications">Module contents</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../profiles.html">Módulo del Perfil</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../profiles.html#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../profiles.html#module-profiles.admin">profiles.admin module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../profiles.html#module-profiles.forms">profiles.forms module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../profiles.html#profiles-models-module">profiles.models module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../profiles.html#module-profiles.tests">profiles.tests module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../profiles.html#module-profiles.views">profiles.views module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../profiles.html#module-profiles">Module contents</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../reports.html">Módulo de Reportes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../reports.html#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../reports.html#module-reports.admin">reports.admin module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../reports.html#module-reports.models">reports.models module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../reports.html#module-reports.tests">reports.tests module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../reports.html#reports-views-module">reports.views module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../reports.html#module-reports">Module contents</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../webServices.html">Módulo Asíncrono</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../webServices.html#subpackages">Subpackages</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../webServices.html#module-webServices">Module contents</a></li>
</ul>
</li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../index.html">HatosGanaderos</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../index.html">Código de módulo</a> &raquo;</li>
      
    <li>webServices.wsGanados.views</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  <h1>Código fuente para webServices.wsGanados.views</h1><div class="highlight"><pre>
<span class="c">#-*- coding: utf-8 -*-</span>
<span class="kn">from</span> <span class="nn">django.db.models</span> <span class="kn">import</span> <span class="n">Q</span>
<span class="kn">from</span> <span class="nn">django.core.exceptions</span> <span class="kn">import</span> <span class="n">ObjectDoesNotExist</span>
<span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span>
<span class="kn">from</span> <span class="nn">ganados.models</span> <span class="kn">import</span> <span class="n">Ganado</span><span class="p">,</span> <span class="n">Identificacion_Simple</span><span class="p">,</span> <span class="n">Ganaderia</span><span class="p">,</span> <span class="n">Etapa</span><span class="p">,</span> <span class="n">Identificacion_Ecuador</span><span class="p">,</span> <span class="n">Ciclo</span><span class="p">,</span> <span class="n">Verification</span><span class="p">,</span> <span class="n">Insemination</span><span class="p">,</span> <span class="n">Ordenio</span>
<span class="kn">from</span> <span class="nn">medicament.models</span> <span class="kn">import</span> <span class="n">Medicament</span>
<span class="kn">from</span> <span class="nn">alimentos.models</span> <span class="kn">import</span> <span class="n">Food</span><span class="p">,</span> <span class="n">ApplicationFood</span>
<span class="kn">from</span> <span class="nn">medicament.models</span> <span class="kn">import</span> <span class="n">Medicament</span><span class="p">,</span> <span class="n">ApplicationMedicament</span>
<span class="kn">from</span> <span class="nn">notifications.models</span> <span class="kn">import</span> <span class="n">Notification</span>
<span class="kn">from</span> <span class="nn">profiles.models</span> <span class="kn">import</span> <span class="n">Configuracion</span><span class="p">,</span> <span class="n">Profile</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">redirect</span><span class="p">,</span> <span class="n">HttpResponseRedirect</span>

<span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>

<span class="kn">from</span> <span class="nn">django.core</span> <span class="kn">import</span> <span class="n">serializers</span>
<span class="kn">from</span> <span class="nn">django.utils</span> <span class="kn">import</span> <span class="n">simplejson</span> <span class="k">as</span> <span class="n">json</span>
<span class="kn">from</span> <span class="nn">ganados.models</span> <span class="kn">import</span> <span class="n">Celo</span>

<span class="kn">from</span> <span class="nn">django.contrib.auth.decorators</span> <span class="kn">import</span> <span class="n">login_required</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">date</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">from</span> <span class="nn">dateutil.relativedelta</span> <span class="kn">import</span> <span class="n">relativedelta</span>

<span class="kn">from</span> <span class="nn">drealtime</span> <span class="kn">import</span> <span class="n">iShoutClient</span>
<span class="n">ishout_client</span> <span class="o">=</span> <span class="n">iShoutClient</span><span class="p">()</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>

<span class="kn">import</span> <span class="nn">pytz</span>

<span class="c"># var aux</span>
<span class="n">user_name</span> <span class="o">=</span> <span class="mi">0</span>


<span class="nd">@login_required</span>
<div class="viewcode-block" id="wsGanadosHembras_view"><a class="viewcode-back" href="../../../webServices.wsGanados.html#webServices.wsGanados.views.wsGanadosHembras_view">[documentos]</a><span class="k">def</span> <span class="nf">wsGanadosHembras_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
	<span class="n">search</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="p">[</span><span class="s">&#39;search&#39;</span><span class="p">]</span>
	<span class="n">user</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
	<span class="n">id_user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">user</span><span class="o">.</span><span class="n">username</span><span class="p">)</span>
	<span class="n">ganaderia</span> <span class="o">=</span> <span class="n">Ganaderia</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">perfil</span><span class="o">=</span><span class="n">id_user</span><span class="p">)</span>
	<span class="n">configuracion</span> <span class="o">=</span> <span class="n">Configuracion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">ganaderia</span><span class="o">.</span><span class="n">configuracion_id</span><span class="p">)</span>
	

	<span class="k">if</span> <span class="n">configuracion</span><span class="o">.</span><span class="n">tipo_identificacion</span> <span class="o">==</span> <span class="s">&#39;simple&#39;</span> <span class="ow">and</span> <span class="n">search</span> <span class="o">!=</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
		<span class="n">data</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="s">&#39;json&#39;</span><span class="p">,</span> <span class="n">Identificacion_Simple</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
					  <span class="p">(</span><span class="n">Q</span><span class="p">(</span><span class="n">identificaciones_simples__ganaderia</span><span class="o">=</span><span class="n">ganaderia</span><span class="p">)</span>
					  <span class="p">)</span> <span class="o">&amp;</span>
					  <span class="p">(</span>	<span class="n">Q</span><span class="p">(</span><span class="n">identificaciones_simples__nacimiento__icontains</span><span class="o">=</span><span class="n">search</span><span class="p">)</span> <span class="o">|</span>
					  	<span class="n">Q</span><span class="p">(</span><span class="n">rp__iexact</span><span class="o">=</span><span class="n">search</span><span class="p">)</span> <span class="o">|</span>
					  	<span class="n">Q</span><span class="p">(</span><span class="n">nombre__icontains</span><span class="o">=</span><span class="n">search</span><span class="p">)</span>
					  <span class="p">)</span> <span class="o">&amp;</span>
					    <span class="n">Q</span><span class="p">(</span><span class="n">identificaciones_simples__etapas__nombre__exact</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
					    <span class="n">identificaciones_simples__etapas__is_active__exact</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
					    <span class="n">identificaciones_simples__genero__exact</span><span class="o">=</span><span class="mi">1</span> <span class="p">)</span>
		<span class="p">))</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">data</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="s">&#39;json&#39;</span><span class="p">,</span> <span class="n">Identificacion_Ecuador</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
					  <span class="p">(</span><span class="n">Q</span><span class="p">(</span><span class="n">identificaciones_ecuador__ganaderia</span><span class="o">=</span><span class="n">ganaderia</span><span class="p">)</span>
					  <span class="p">)</span> <span class="o">&amp;</span>
					  <span class="p">(</span>	<span class="n">Q</span><span class="p">(</span><span class="n">identificaciones_ecuador__nacimiento__icontains</span><span class="o">=</span><span class="n">search</span><span class="p">)</span> <span class="o">|</span>
					  	<span class="n">Q</span><span class="p">(</span><span class="n">rp__iexact</span><span class="o">=</span><span class="n">search</span><span class="p">)</span> <span class="o">|</span>
					  	<span class="n">Q</span><span class="p">(</span><span class="n">nombre__icontains</span><span class="o">=</span><span class="n">search</span><span class="p">)</span>
					  <span class="p">)</span> <span class="o">&amp;</span>
					    <span class="n">Q</span><span class="p">(</span><span class="n">identificaciones_ecuador__etapas__nombre__exact</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
					    <span class="n">identificaciones_ecuador__etapas__is_active__exact</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
					    <span class="n">identificaciones_ecuador__genero__exact</span><span class="o">=</span><span class="mi">1</span> <span class="p">)</span>
		<span class="p">))</span>
	<span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">mimetype</span><span class="o">=</span><span class="s">&#39;application/json&#39;</span><span class="p">)</span>
</div>
<span class="nd">@login_required</span>
<div class="viewcode-block" id="ajaxCattleMaleRp_view"><a class="viewcode-back" href="../../../webServices.wsGanados.html#webServices.wsGanados.views.ajaxCattleMaleRp_view">[documentos]</a><span class="k">def</span> <span class="nf">ajaxCattleMaleRp_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
	<span class="n">search</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="p">[</span><span class="s">&#39;search&#39;</span><span class="p">]</span>
	<span class="n">user</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
	<span class="n">farm</span> <span class="o">=</span> <span class="n">Ganaderia</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">perfil</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>
	<span class="n">configuration</span> <span class="o">=</span> <span class="n">Configuracion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">farm</span><span class="o">.</span><span class="n">configuracion_id</span><span class="p">)</span>
	
	<span class="n">gg</span> <span class="o">=</span> <span class="n">Ganado</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">ganaderia</span><span class="o">=</span><span class="n">farm</span><span class="p">)</span>

	<span class="k">if</span> <span class="n">configuration</span><span class="o">.</span><span class="n">tipo_identificacion</span> <span class="o">==</span> <span class="s">&#39;simple&#39;</span> <span class="ow">and</span> <span class="n">search</span> <span class="o">!=</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
		<span class="n">data</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="s">&#39;json&#39;</span><span class="p">,</span> <span class="n">Identificacion_Simple</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
					  <span class="p">(</span><span class="n">Q</span><span class="p">(</span><span class="n">identificaciones_simples__ganaderia</span><span class="o">=</span><span class="n">farm</span><span class="p">)</span>
					  <span class="p">)</span> <span class="o">&amp;</span>
					  <span class="p">(</span>	<span class="n">Q</span><span class="p">(</span><span class="n">identificaciones_simples__nacimiento__icontains</span><span class="o">=</span><span class="n">search</span><span class="p">)</span> <span class="o">|</span>
					  	<span class="n">Q</span><span class="p">(</span><span class="n">rp__iexact</span><span class="o">=</span><span class="n">search</span><span class="p">)</span> <span class="o">|</span>
					  	<span class="n">Q</span><span class="p">(</span><span class="n">nombre__icontains</span><span class="o">=</span><span class="n">search</span><span class="p">)</span>
					  <span class="p">)</span> <span class="o">&amp;</span>
					  	<span class="n">Q</span><span class="p">(</span><span class="n">identificaciones_simples__genero__exact</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
		<span class="p">))</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">data</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="s">&#39;json&#39;</span><span class="p">,</span> <span class="n">Identificacion_Ecuador</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
					  <span class="p">(</span><span class="n">Q</span><span class="p">(</span><span class="n">identificaciones_ecuador__ganaderia</span><span class="o">=</span><span class="n">farm</span><span class="p">)</span>
					  <span class="p">)</span> <span class="o">&amp;</span>
					  <span class="p">(</span>	<span class="n">Q</span><span class="p">(</span><span class="n">identificaciones_ecuador__nacimiento__icontains</span><span class="o">=</span><span class="n">search</span><span class="p">)</span> <span class="o">|</span>
					  	<span class="n">Q</span><span class="p">(</span><span class="n">rp__iexact</span><span class="o">=</span><span class="n">search</span><span class="p">)</span> <span class="o">|</span>
					  	<span class="n">Q</span><span class="p">(</span><span class="n">nombre__icontains</span><span class="o">=</span><span class="n">search</span><span class="p">)</span>
					  <span class="p">)</span> <span class="o">&amp;</span>
					  	<span class="n">Q</span><span class="p">(</span><span class="n">identificaciones_ecuador__genero__exact</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
		<span class="p">))</span>
	<span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">mimetype</span><span class="o">=</span><span class="s">&#39;application/json&#39;</span><span class="p">)</span>
</div>
<span class="nd">@login_required</span>
<div class="viewcode-block" id="ajaxGanadosMachosInseminacion_view"><a class="viewcode-back" href="../../../webServices.wsGanados.html#webServices.wsGanados.views.ajaxGanadosMachosInseminacion_view">[documentos]</a><span class="k">def</span> <span class="nf">ajaxGanadosMachosInseminacion_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
	<span class="n">search</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="p">[</span><span class="s">&#39;search&#39;</span><span class="p">]</span>
	<span class="n">user</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
	<span class="n">farm</span> <span class="o">=</span> <span class="n">Ganaderia</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">perfil</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>
	
	<span class="n">data</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="s">&#39;json&#39;</span><span class="p">,</span> <span class="n">Insemination</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
				  <span class="p">(</span><span class="n">Q</span><span class="p">(</span><span class="n">farm</span><span class="o">=</span><span class="n">farm</span><span class="p">)</span>
				  <span class="p">)</span> <span class="o">&amp;</span>
				  <span class="p">(</span>	<span class="n">Q</span><span class="p">(</span><span class="n">registration_date__icontains</span><span class="o">=</span><span class="n">search</span><span class="p">)</span> <span class="o">|</span>
				  	<span class="n">Q</span><span class="p">(</span><span class="n">rp__iexact</span><span class="o">=</span><span class="n">search</span><span class="p">)</span> <span class="o">|</span>
				  	<span class="n">Q</span><span class="p">(</span><span class="n">name__icontains</span><span class="o">=</span><span class="n">search</span><span class="p">)</span>
				  <span class="p">)</span> 
		<span class="p">))</span>
	
	<span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">mimetype</span><span class="o">=</span><span class="s">&#39;application/json&#39;</span><span class="p">)</span>
</div>
<span class="nd">@login_required</span>
<div class="viewcode-block" id="wsGanados_view"><a class="viewcode-back" href="../../../webServices.wsGanados.html#webServices.wsGanados.views.wsGanados_view">[documentos]</a><span class="k">def</span> <span class="nf">wsGanados_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
	<span class="n">search</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="p">[</span><span class="s">&#39;search&#39;</span><span class="p">]</span>
	<span class="n">user</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
	<span class="n">ganaderia</span> <span class="o">=</span> <span class="n">Ganaderia</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">perfil</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>

	<span class="k">if</span> <span class="n">ganaderia</span><span class="o">.</span><span class="n">configuracion</span><span class="o">.</span><span class="n">tipo_identificacion</span> <span class="o">==</span> <span class="s">&#39;simple&#39;</span><span class="p">:</span>
	
		<span class="n">ganados</span> <span class="o">=</span> <span class="n">Ganado</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
											<span class="n">Q</span><span class="p">(</span><span class="n">ganaderia</span><span class="o">=</span><span class="n">ganaderia</span><span class="p">,</span> <span class="n">genero</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span>
											<span class="p">(</span>
												<span class="n">Q</span><span class="p">(</span><span class="n">nacimiento__icontains</span><span class="o">=</span><span class="n">search</span><span class="p">)</span> <span class="o">|</span>
												<span class="n">Q</span><span class="p">(</span><span class="n">identificacion_simple__nombre__icontains</span><span class="o">=</span><span class="n">search</span><span class="p">)</span> <span class="o">|</span>
												<span class="n">Q</span><span class="p">(</span><span class="n">identificacion_simple__rp__icontains</span><span class="o">=</span><span class="n">search</span><span class="p">)</span>
											<span class="p">)</span>
										<span class="p">)</span>
		
		<span class="n">celos</span> <span class="o">=</span> <span class="n">Celo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">is_active</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">estado</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ganado_id</span><span class="o">=</span><span class="n">ganados</span><span class="p">)</span>
		<span class="n">etapas</span> <span class="o">=</span> <span class="n">Etapa</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">is_active</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">ganado_id</span><span class="o">=</span><span class="n">ganados</span><span class="p">)</span>
		<span class="n">ciclos</span> <span class="o">=</span> <span class="n">Ciclo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">is_active</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">ganado_id</span><span class="o">=</span><span class="n">ganados</span><span class="p">)</span>
		<span class="n">verificaciones</span> <span class="o">=</span> <span class="n">Verification</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">is_active</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">cattle_id</span><span class="o">=</span><span class="n">ganados</span><span class="p">)</span>

		<span class="c"># serializando</span>
		<span class="n">data</span> <span class="o">=</span> <span class="s">&#39;[&#39;</span>
		<span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">ganados</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">data</span> <span class="o">==</span> <span class="s">&#39;[&#39;</span><span class="p">:</span>
				<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;{&quot;pk&quot;: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;, &#39;</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;,{&quot;pk&quot;: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;, &#39;</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;&quot;fields&quot;: {&#39;</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;&quot;rp&quot;: &quot;&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">identificacion_simple</span><span class="o">.</span><span class="n">rp</span><span class="p">)</span> <span class="o">+</span><span class="s">&#39;&quot;&#39;</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;imagen&quot;: &quot;&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">imagen</span><span class="p">)</span> <span class="o">+</span><span class="s">&#39;&quot;&#39;</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;nombre&quot;: &quot;&#39;</span><span class="o">+</span> <span class="n">g</span><span class="o">.</span><span class="n">identificacion_simple</span><span class="o">.</span><span class="n">nombre</span> <span class="o">+</span><span class="s">&#39;&quot;&#39;</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;edad_anios&quot;: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">edad_anios</span> <span class="p">)</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;edad_meses&quot;: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">edad_meses</span> <span class="p">)</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;edad_dias&quot;: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">edad_dias</span> <span class="p">)</span>

			<span class="k">if</span> <span class="n">celos</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
				<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">celos</span><span class="p">:</span>
					<span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">ganado_id</span> <span class="o">==</span> <span class="n">g</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
						<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;celo&quot;: &quot;En Celo&quot;&#39;</span>
					<span class="k">else</span><span class="p">:</span>
						<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;celo&quot;: &quot;Sin Celo&quot;&#39;</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;celo&quot;: &quot;Sin celo&quot;&#39;</span>
				
			<span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">etapas</span><span class="p">:</span>
				<span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">ganado_id</span> <span class="o">==</span> <span class="n">g</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
					<span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">nombre</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
						<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;etapa&quot;: &quot;Ternera&quot;&#39;</span>
					<span class="k">elif</span> <span class="n">e</span><span class="o">.</span><span class="n">nombre</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
						<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;etapa&quot;: &quot;Vacona&quot;&#39;</span>
					<span class="k">elif</span> <span class="n">e</span><span class="o">.</span><span class="n">nombre</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
						<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;etapa&quot;: &quot;Vientre&quot;&#39;</span>

			<span class="k">for</span> <span class="n">ciclo</span> <span class="ow">in</span> <span class="n">ciclos</span><span class="p">:</span>
				<span class="k">if</span> <span class="n">ciclo</span><span class="o">.</span><span class="n">ganado_id</span> <span class="o">==</span> <span class="n">g</span><span class="o">.</span><span class="n">id</span> <span class="ow">and</span> <span class="n">ciclo</span><span class="o">.</span><span class="n">is_active</span><span class="p">:</span>
					<span class="k">if</span> <span class="n">ciclo</span><span class="o">.</span><span class="n">nombre</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
						<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;ciclo&quot;: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ciclo</span><span class="o">.</span><span class="n">nombre</span><span class="p">)</span> 
					<span class="k">elif</span> <span class="n">ciclo</span><span class="o">.</span><span class="n">nombre</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
						<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;ciclo&quot;: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ciclo</span><span class="o">.</span><span class="n">nombre</span><span class="p">)</span> 
					<span class="k">elif</span> <span class="n">ciclo</span><span class="o">.</span><span class="n">nombre</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
						<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;ciclo&quot;: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ciclo</span><span class="o">.</span><span class="n">nombre</span><span class="p">)</span> 
					<span class="k">elif</span> <span class="n">ciclo</span><span class="o">.</span><span class="n">nombre</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
						<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;ciclo&quot;: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ciclo</span><span class="o">.</span><span class="n">nombre</span><span class="p">)</span> 

			<span class="k">for</span> <span class="n">verificacion</span> <span class="ow">in</span> <span class="n">verificaciones</span><span class="p">:</span>
				<span class="k">if</span> <span class="n">verificacion</span><span class="o">.</span><span class="n">cattle_id</span> <span class="o">==</span> <span class="n">g</span><span class="o">.</span><span class="n">id</span> <span class="ow">and</span> <span class="n">verificacion</span><span class="o">.</span><span class="n">is_active</span><span class="p">:</span>
					<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;verificacion&quot;: &quot;True&quot;&#39;</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;verificacion&quot;: &quot;False&quot;&#39;</span>
					

			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;}}&#39;</span>
		<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;]&#39;</span>

	<span class="k">else</span><span class="p">:</span>
		<span class="n">ganados</span> <span class="o">=</span> <span class="n">Ganado</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
										<span class="n">Q</span><span class="p">(</span><span class="n">ganaderia</span><span class="o">=</span><span class="n">ganaderia</span><span class="p">,</span> <span class="n">genero</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span>
										<span class="p">(</span>
											<span class="n">Q</span><span class="p">(</span><span class="n">nacimiento__icontains</span><span class="o">=</span><span class="n">search</span><span class="p">)</span> <span class="o">|</span>
											<span class="n">Q</span><span class="p">(</span><span class="n">identificacion_ecuador__nombre__icontains</span><span class="o">=</span><span class="n">search</span><span class="p">)</span> <span class="o">|</span>
											<span class="n">Q</span><span class="p">(</span><span class="n">identificacion_ecuador__rp__icontains</span><span class="o">=</span><span class="n">search</span><span class="p">)</span>
										<span class="p">)</span>
									<span class="p">)</span>
		
		<span class="n">celos</span> <span class="o">=</span> <span class="n">Celo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">is_active</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">estado</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ganado_id</span><span class="o">=</span><span class="n">ganados</span><span class="p">)</span>
		<span class="n">etapas</span> <span class="o">=</span> <span class="n">Etapa</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">is_active</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">ganado_id</span><span class="o">=</span><span class="n">ganados</span><span class="p">)</span>
		<span class="n">ciclos</span> <span class="o">=</span> <span class="n">Ciclo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">is_active</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">ganado_id</span><span class="o">=</span><span class="n">ganados</span><span class="p">)</span>
		<span class="n">verificaciones</span> <span class="o">=</span> <span class="n">Verification</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">is_active</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">cattle_id</span><span class="o">=</span><span class="n">ganados</span><span class="p">)</span>

		<span class="c"># serializando</span>
		<span class="n">data</span> <span class="o">=</span> <span class="s">&#39;[&#39;</span>
		<span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">ganados</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">data</span> <span class="o">==</span> <span class="s">&#39;[&#39;</span><span class="p">:</span>
				<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;{&quot;pk&quot;: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;, &#39;</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;,{&quot;pk&quot;: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;, &#39;</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;&quot;fields&quot;: {&#39;</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;&quot;rp&quot;: &quot;&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">identificacion_ecuador</span><span class="o">.</span><span class="n">rp</span><span class="p">)</span> <span class="o">+</span><span class="s">&#39;&quot;&#39;</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;imagen&quot;: &quot;&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">imagen</span><span class="p">)</span> <span class="o">+</span><span class="s">&#39;&quot;&#39;</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;nombre&quot;: &quot;&#39;</span><span class="o">+</span> <span class="n">g</span><span class="o">.</span><span class="n">identificacion_ecuador</span><span class="o">.</span><span class="n">nombre</span> <span class="o">+</span><span class="s">&#39;&quot;&#39;</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;edad_anios&quot;: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">edad_anios</span> <span class="p">)</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;edad_meses&quot;: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">edad_meses</span> <span class="p">)</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;edad_dias&quot;: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">edad_dias</span> <span class="p">)</span>

			<span class="k">if</span> <span class="n">celos</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
				<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">celos</span><span class="p">:</span>
					<span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">ganado_id</span> <span class="o">==</span> <span class="n">g</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
						<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;celo&quot;: &quot;En Celo&quot;&#39;</span>
					<span class="k">else</span><span class="p">:</span>
						<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;celo&quot;: &quot;Sin Celo&quot;&#39;</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;celo&quot;: &quot;Sin celo&quot;&#39;</span>
				
			<span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">etapas</span><span class="p">:</span>
				<span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">ganado_id</span> <span class="o">==</span> <span class="n">g</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
					<span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">nombre</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
						<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;etapa&quot;: &quot;Ternera&quot;&#39;</span>
					<span class="k">elif</span> <span class="n">e</span><span class="o">.</span><span class="n">nombre</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
						<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;etapa&quot;: &quot;Vacona&quot;&#39;</span>
					<span class="k">elif</span> <span class="n">e</span><span class="o">.</span><span class="n">nombre</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
						<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;etapa&quot;: &quot;Vientre&quot;&#39;</span>

			<span class="k">if</span> <span class="n">ciclos</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
				<span class="k">for</span> <span class="n">ciclo</span> <span class="ow">in</span> <span class="n">ciclos</span><span class="p">:</span>
					<span class="k">if</span> <span class="n">ciclo</span><span class="o">.</span><span class="n">ganado_id</span> <span class="o">==</span> <span class="n">g</span><span class="o">.</span><span class="n">id</span> <span class="ow">and</span> <span class="n">ciclo</span><span class="o">.</span><span class="n">is_active</span><span class="p">:</span>
						<span class="k">if</span> <span class="n">ciclo</span><span class="o">.</span><span class="n">nombre</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
							<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;ciclo&quot;: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ciclo</span><span class="o">.</span><span class="n">nombre</span><span class="p">)</span> 
						<span class="k">elif</span> <span class="n">ciclo</span><span class="o">.</span><span class="n">nombre</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
							<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;ciclo&quot;: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ciclo</span><span class="o">.</span><span class="n">nombre</span><span class="p">)</span> 
						<span class="k">elif</span> <span class="n">ciclo</span><span class="o">.</span><span class="n">nombre</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
							<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;ciclo&quot;: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ciclo</span><span class="o">.</span><span class="n">nombre</span><span class="p">)</span> 
						<span class="k">elif</span> <span class="n">ciclo</span><span class="o">.</span><span class="n">nombre</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
							<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;ciclo&quot;: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ciclo</span><span class="o">.</span><span class="n">nombre</span><span class="p">)</span> 

			<span class="k">if</span> <span class="n">verificaciones</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
				<span class="k">for</span> <span class="n">verificacion</span> <span class="ow">in</span> <span class="n">verificaciones</span><span class="p">:</span>
					<span class="k">if</span> <span class="n">verificacion</span><span class="o">.</span><span class="n">cattle_id</span> <span class="o">==</span> <span class="n">g</span><span class="o">.</span><span class="n">id</span> <span class="ow">and</span> <span class="n">verificacion</span><span class="o">.</span><span class="n">is_active</span><span class="p">:</span>
						<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;verificacion&quot;: &quot;True&quot;&#39;</span>
					<span class="k">else</span><span class="p">:</span>
						<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;verificacion&quot;: &quot;False&quot;&#39;</span>
					

			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;}}&#39;</span>
		<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;]&#39;</span>
		
		<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		reigistros = LoadTest.objects.all()</span>
<span class="sd">		datas = serializers.serialize(&#39;json&#39;, reigistros, indent=2)</span>
<span class="sd">		&#39;&#39;&#39;</span>
	
	<span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">mimetype</span><span class="o">=</span><span class="s">&#39;application/json&#39;</span><span class="p">)</span>
</div>
<span class="nd">@login_required</span>
<div class="viewcode-block" id="ajaxCattleMale_view"><a class="viewcode-back" href="../../../webServices.wsGanados.html#webServices.wsGanados.views.ajaxCattleMale_view">[documentos]</a><span class="k">def</span> <span class="nf">ajaxCattleMale_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
	<span class="n">search</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="p">[</span><span class="s">&#39;search&#39;</span><span class="p">]</span>
	<span class="n">user</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
	<span class="n">ganaderia</span> <span class="o">=</span> <span class="n">Ganaderia</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">perfil</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>

	<span class="k">if</span> <span class="n">ganaderia</span><span class="o">.</span><span class="n">configuracion</span><span class="o">.</span><span class="n">tipo_identificacion</span> <span class="o">==</span> <span class="s">&#39;simple&#39;</span><span class="p">:</span>
	
		<span class="n">ganados</span> <span class="o">=</span> <span class="n">Ganado</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
											<span class="n">Q</span><span class="p">(</span><span class="n">ganaderia</span><span class="o">=</span><span class="n">ganaderia</span><span class="p">,</span> <span class="n">genero</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span>
											<span class="p">(</span>
												<span class="n">Q</span><span class="p">(</span><span class="n">nacimiento__icontains</span><span class="o">=</span><span class="n">search</span><span class="p">)</span> <span class="o">|</span>
												<span class="n">Q</span><span class="p">(</span><span class="n">identificacion_simple__nombre__icontains</span><span class="o">=</span><span class="n">search</span><span class="p">)</span> <span class="o">|</span>
												<span class="n">Q</span><span class="p">(</span><span class="n">identificacion_simple__rp__icontains</span><span class="o">=</span><span class="n">search</span><span class="p">)</span>
											<span class="p">)</span>
										<span class="p">)</span>

		<span class="c"># serializando</span>
		<span class="n">data</span> <span class="o">=</span> <span class="s">&#39;[&#39;</span>
		<span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">ganados</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">data</span> <span class="o">==</span> <span class="s">&#39;[&#39;</span><span class="p">:</span>
				<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;{&quot;pk&quot;: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;, &#39;</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;,{&quot;pk&quot;: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;, &#39;</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;&quot;fields&quot;: {&#39;</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;&quot;rp&quot;: &quot;&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">identificacion_simple</span><span class="o">.</span><span class="n">rp</span><span class="p">)</span> <span class="o">+</span><span class="s">&#39;&quot;&#39;</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;imagen&quot;: &quot;&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">imagen</span><span class="p">)</span> <span class="o">+</span><span class="s">&#39;&quot;&#39;</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;nombre&quot;: &quot;&#39;</span><span class="o">+</span> <span class="n">g</span><span class="o">.</span><span class="n">identificacion_simple</span><span class="o">.</span><span class="n">nombre</span> <span class="o">+</span><span class="s">&#39;&quot;&#39;</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;edad_anios&quot;: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">edad_anios</span> <span class="p">)</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;edad_meses&quot;: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">edad_meses</span> <span class="p">)</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;edad_dias&quot;: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">edad_dias</span> <span class="p">)</span>

			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;}}&#39;</span>
		<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;]&#39;</span>

	<span class="k">else</span><span class="p">:</span>
		<span class="n">ganados</span> <span class="o">=</span> <span class="n">Ganado</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
										<span class="n">Q</span><span class="p">(</span><span class="n">ganaderia</span><span class="o">=</span><span class="n">ganaderia</span><span class="p">,</span> <span class="n">genero</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span>
										<span class="p">(</span>
											<span class="n">Q</span><span class="p">(</span><span class="n">nacimiento__icontains</span><span class="o">=</span><span class="n">search</span><span class="p">)</span> <span class="o">|</span>
											<span class="n">Q</span><span class="p">(</span><span class="n">identificacion_ecuador__nombre__icontains</span><span class="o">=</span><span class="n">search</span><span class="p">)</span> <span class="o">|</span>
											<span class="n">Q</span><span class="p">(</span><span class="n">identificacion_ecuador__rp__icontains</span><span class="o">=</span><span class="n">search</span><span class="p">)</span>
										<span class="p">)</span>
									<span class="p">)</span>
		
		<span class="c"># serializando</span>
		<span class="n">data</span> <span class="o">=</span> <span class="s">&#39;[&#39;</span>
		<span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">ganados</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">data</span> <span class="o">==</span> <span class="s">&#39;[&#39;</span><span class="p">:</span>
				<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;{&quot;pk&quot;: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;, &#39;</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;,{&quot;pk&quot;: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;, &#39;</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;&quot;fields&quot;: {&#39;</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;&quot;rp&quot;: &quot;&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">identificacion_ecuador</span><span class="o">.</span><span class="n">rp</span><span class="p">)</span> <span class="o">+</span><span class="s">&#39;&quot;&#39;</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;imagen&quot;: &quot;&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">imagen</span><span class="p">)</span> <span class="o">+</span><span class="s">&#39;&quot;&#39;</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;nombre&quot;: &quot;&#39;</span><span class="o">+</span> <span class="n">g</span><span class="o">.</span><span class="n">identificacion_ecuador</span><span class="o">.</span><span class="n">nombre</span> <span class="o">+</span><span class="s">&#39;&quot;&#39;</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;edad_anios&quot;: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">edad_anios</span> <span class="p">)</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;edad_meses&quot;: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">edad_meses</span> <span class="p">)</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;edad_dias&quot;: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">edad_dias</span> <span class="p">)</span>

			
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;}}&#39;</span>
		<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;]&#39;</span>
		
	
	<span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">mimetype</span><span class="o">=</span><span class="s">&#39;application/json&#39;</span><span class="p">)</span>
</div>
<span class="nd">@login_required</span>
<div class="viewcode-block" id="wsGanadosProduccion_view"><a class="viewcode-back" href="../../../webServices.wsGanados.html#webServices.wsGanados.views.wsGanadosProduccion_view">[documentos]</a><span class="k">def</span> <span class="nf">wsGanadosProduccion_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
	<span class="n">search</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="p">[</span><span class="s">&#39;search&#39;</span><span class="p">]</span>
	<span class="n">user</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
	<span class="n">ganaderia</span> <span class="o">=</span> <span class="n">Ganaderia</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">perfil</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>

	<span class="k">if</span> <span class="n">ganaderia</span><span class="o">.</span><span class="n">configuracion</span><span class="o">.</span><span class="n">tipo_identificacion</span> <span class="o">==</span> <span class="s">&#39;simple&#39;</span><span class="p">:</span>

		<span class="n">ganados</span> <span class="o">=</span> <span class="n">Ganado</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
											<span class="n">Q</span><span class="p">(</span><span class="n">ganaderia</span><span class="o">=</span><span class="n">ganaderia</span><span class="p">,</span> <span class="n">genero</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">etapas__nombre</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ciclos__nombre</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span>
											<span class="p">(</span>
												<span class="n">Q</span><span class="p">(</span><span class="n">identificacion_simple__rp__icontains</span><span class="o">=</span><span class="n">search</span><span class="p">)</span> <span class="o">|</span>
												<span class="n">Q</span><span class="p">(</span><span class="n">nacimiento__icontains</span><span class="o">=</span><span class="n">search</span><span class="p">)</span> <span class="o">|</span>
												<span class="n">Q</span><span class="p">(</span><span class="n">identificacion_simple__nombre__icontains</span><span class="o">=</span><span class="n">search</span><span class="p">)</span> 
											<span class="p">)</span>
										<span class="p">)</span>
		<span class="n">celos</span> <span class="o">=</span> <span class="n">Celo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">is_active</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">ganado_id</span><span class="o">=</span><span class="n">ganados</span><span class="p">)</span>
		<span class="n">etapas</span> <span class="o">=</span> <span class="n">Etapa</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">is_active</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">ganado_id</span><span class="o">=</span><span class="n">ganados</span><span class="p">)</span>
		<span class="n">ciclos</span> <span class="o">=</span> <span class="n">Ciclo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">is_active</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">ganado_id</span><span class="o">=</span><span class="n">ganados</span><span class="p">)</span>
		<span class="n">verificaciones</span> <span class="o">=</span> <span class="n">Verification</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">is_active</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">cattle_id</span><span class="o">=</span><span class="n">ganados</span><span class="p">)</span>
		<span class="c"># serializando</span>
		<span class="n">data</span> <span class="o">=</span> <span class="s">&#39;[&#39;</span>
		<span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">ganados</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">data</span> <span class="o">==</span> <span class="s">&#39;[&#39;</span><span class="p">:</span>
				<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;{&quot;pk&quot;: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;, &#39;</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;,{&quot;pk&quot;: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;, &#39;</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;&quot;fields&quot;: {&#39;</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;&quot;rp&quot;: &quot;&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">identificacion_simple</span><span class="o">.</span><span class="n">rp</span><span class="p">)</span> <span class="o">+</span><span class="s">&#39;&quot;&#39;</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;imagen&quot;: &quot;&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">imagen</span><span class="p">)</span> <span class="o">+</span><span class="s">&#39;&quot;&#39;</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;nombre&quot;: &quot;&#39;</span><span class="o">+</span> <span class="n">g</span><span class="o">.</span><span class="n">identificacion_simple</span><span class="o">.</span><span class="n">nombre</span> <span class="o">+</span><span class="s">&#39;&quot;&#39;</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;edad_anios&quot;: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">edad_anios</span> <span class="p">)</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;edad_meses&quot;: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">edad_meses</span> <span class="p">)</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;edad_dias&quot;: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">edad_dias</span> <span class="p">)</span>

			<span class="k">if</span> <span class="n">celos</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
				<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">celos</span><span class="p">:</span>
					<span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">ganado_id</span> <span class="o">==</span> <span class="n">g</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
						<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;celo&quot;: &quot;En celo&quot;&#39;</span>
					<span class="k">else</span><span class="p">:</span>
						<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;celo&quot;: &quot;Sin celo&quot;&#39;</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;celo&quot;: &quot;Sin celo&quot;&#39;</span>
				
			<span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">etapas</span><span class="p">:</span>
				<span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">ganado_id</span> <span class="o">==</span> <span class="n">g</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
					<span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">nombre</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
						<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;etapa&quot;: &quot;Ternera&quot;&#39;</span>
					<span class="k">elif</span> <span class="n">e</span><span class="o">.</span><span class="n">nombre</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
						<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;etapa&quot;: &quot;Vacona&quot;&#39;</span>
					<span class="k">elif</span> <span class="n">e</span><span class="o">.</span><span class="n">nombre</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
						<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;etapa&quot;: &quot;Vientre&quot;&#39;</span>

			<span class="k">for</span> <span class="n">ciclo</span> <span class="ow">in</span> <span class="n">ciclos</span><span class="p">:</span>
				<span class="k">if</span> <span class="n">ciclo</span><span class="o">.</span><span class="n">ganado_id</span> <span class="o">==</span> <span class="n">g</span><span class="o">.</span><span class="n">id</span> <span class="ow">and</span> <span class="n">ciclo</span><span class="o">.</span><span class="n">is_active</span><span class="p">:</span>
					<span class="k">if</span> <span class="n">ciclo</span><span class="o">.</span><span class="n">nombre</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
						<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;ciclo&quot;: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ciclo</span><span class="o">.</span><span class="n">nombre</span><span class="p">)</span> 
					<span class="k">elif</span> <span class="n">ciclo</span><span class="o">.</span><span class="n">nombre</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
						<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;ciclo&quot;: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ciclo</span><span class="o">.</span><span class="n">nombre</span><span class="p">)</span> 
					<span class="k">elif</span> <span class="n">ciclo</span><span class="o">.</span><span class="n">nombre</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
						<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;ciclo&quot;: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ciclo</span><span class="o">.</span><span class="n">nombre</span><span class="p">)</span> 
					<span class="k">elif</span> <span class="n">ciclo</span><span class="o">.</span><span class="n">nombre</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
						<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;ciclo&quot;: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ciclo</span><span class="o">.</span><span class="n">nombre</span><span class="p">)</span> 

			<span class="k">for</span> <span class="n">verificacion</span> <span class="ow">in</span> <span class="n">verificaciones</span><span class="p">:</span>
				<span class="k">if</span> <span class="n">verificacion</span><span class="o">.</span><span class="n">cattle_id</span> <span class="o">==</span> <span class="n">g</span><span class="o">.</span><span class="n">id</span> <span class="ow">and</span> <span class="n">verificacion</span><span class="o">.</span><span class="n">is_active</span><span class="p">:</span>
					<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;verificacion&quot;: &quot;True&quot;&#39;</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;verificacion&quot;: &quot;False&quot;&#39;</span>

			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;}}&#39;</span>
		<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;]&#39;</span>

	<span class="k">else</span><span class="p">:</span>
		<span class="n">ganados</span> <span class="o">=</span> <span class="n">Ganado</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
										<span class="n">Q</span><span class="p">(</span><span class="n">ganaderia</span><span class="o">=</span><span class="n">ganaderia</span><span class="p">,</span> <span class="n">genero</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">etapas__nombre</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ciclos__nombre</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span>
										<span class="p">(</span>
											<span class="n">Q</span><span class="p">(</span><span class="n">identificacion_ecuador__rp__icontains</span><span class="o">=</span><span class="n">search</span><span class="p">)</span> <span class="o">|</span>
											<span class="n">Q</span><span class="p">(</span><span class="n">nacimiento__icontains</span><span class="o">=</span><span class="n">search</span><span class="p">)</span> <span class="o">|</span>
											<span class="n">Q</span><span class="p">(</span><span class="n">identificacion_ecuador__nombre__icontains</span><span class="o">=</span><span class="n">search</span><span class="p">)</span> 
										<span class="p">)</span>
									<span class="p">)</span>
		<span class="n">celos</span> <span class="o">=</span> <span class="n">Celo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">is_active</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">ganado_id</span><span class="o">=</span><span class="n">ganados</span><span class="p">)</span>
		<span class="n">etapas</span> <span class="o">=</span> <span class="n">Etapa</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">is_active</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">ganado_id</span><span class="o">=</span><span class="n">ganados</span><span class="p">)</span>
		<span class="n">ciclos</span> <span class="o">=</span> <span class="n">Ciclo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">is_active</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">ganado_id</span><span class="o">=</span><span class="n">ganados</span><span class="p">)</span>
		<span class="n">verificaciones</span> <span class="o">=</span> <span class="n">Verification</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">is_active</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">cattle_id</span><span class="o">=</span><span class="n">ganados</span><span class="p">)</span>
		<span class="c"># serializando</span>
		<span class="n">data</span> <span class="o">=</span> <span class="s">&#39;[&#39;</span>
		<span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">ganados</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">data</span> <span class="o">==</span> <span class="s">&#39;[&#39;</span><span class="p">:</span>
				<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;{&quot;pk&quot;: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;, &#39;</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;,{&quot;pk&quot;: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;, &#39;</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;&quot;fields&quot;: {&#39;</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;&quot;rp&quot;: &quot;&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">identificacion_ecuador</span><span class="o">.</span><span class="n">rp</span><span class="p">)</span> <span class="o">+</span><span class="s">&#39;&quot;&#39;</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;imagen&quot;: &quot;&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">imagen</span><span class="p">)</span> <span class="o">+</span><span class="s">&#39;&quot;&#39;</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;nombre&quot;: &quot;&#39;</span><span class="o">+</span> <span class="n">g</span><span class="o">.</span><span class="n">identificacion_ecuador</span><span class="o">.</span><span class="n">nombre</span> <span class="o">+</span><span class="s">&#39;&quot;&#39;</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;edad_anios&quot;: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">edad_anios</span> <span class="p">)</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;edad_meses&quot;: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">edad_meses</span> <span class="p">)</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;edad_dias&quot;: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">edad_dias</span> <span class="p">)</span>

			<span class="k">if</span> <span class="n">celos</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
				<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">celos</span><span class="p">:</span>
					<span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">ganado_id</span> <span class="o">==</span> <span class="n">g</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
						<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;celo&quot;: &quot;En celo&quot;&#39;</span>
					<span class="k">else</span><span class="p">:</span>
						<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;celo&quot;: &quot;Sin celo&quot;&#39;</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;celo&quot;: &quot;Sin celo&quot;&#39;</span>
				
			<span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">etapas</span><span class="p">:</span>
				<span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">ganado_id</span> <span class="o">==</span> <span class="n">g</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
					<span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">nombre</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
						<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;etapa&quot;: &quot;Ternera&quot;&#39;</span>
					<span class="k">elif</span> <span class="n">e</span><span class="o">.</span><span class="n">nombre</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
						<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;etapa&quot;: &quot;Vacona&quot;&#39;</span>
					<span class="k">elif</span> <span class="n">e</span><span class="o">.</span><span class="n">nombre</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
						<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;etapa&quot;: &quot;Vientre&quot;&#39;</span>

			<span class="k">if</span> <span class="n">ciclos</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
				<span class="k">for</span> <span class="n">ciclo</span> <span class="ow">in</span> <span class="n">ciclos</span><span class="p">:</span>
					<span class="k">if</span> <span class="n">ciclo</span><span class="o">.</span><span class="n">ganado_id</span> <span class="o">==</span> <span class="n">g</span><span class="o">.</span><span class="n">id</span> <span class="ow">and</span> <span class="n">ciclo</span><span class="o">.</span><span class="n">is_active</span><span class="p">:</span>
						<span class="k">if</span> <span class="n">ciclo</span><span class="o">.</span><span class="n">nombre</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
							<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;ciclo&quot;: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ciclo</span><span class="o">.</span><span class="n">nombre</span><span class="p">)</span> 
						<span class="k">elif</span> <span class="n">ciclo</span><span class="o">.</span><span class="n">nombre</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
							<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;ciclo&quot;: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ciclo</span><span class="o">.</span><span class="n">nombre</span><span class="p">)</span> 
						<span class="k">elif</span> <span class="n">ciclo</span><span class="o">.</span><span class="n">nombre</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
							<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;ciclo&quot;: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ciclo</span><span class="o">.</span><span class="n">nombre</span><span class="p">)</span> 
						<span class="k">elif</span> <span class="n">ciclo</span><span class="o">.</span><span class="n">nombre</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
							<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;ciclo&quot;: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ciclo</span><span class="o">.</span><span class="n">nombre</span><span class="p">)</span> 

			<span class="k">if</span> <span class="n">verificaciones</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
				<span class="k">for</span> <span class="n">verificacion</span> <span class="ow">in</span> <span class="n">verificaciones</span><span class="p">:</span>
					<span class="k">if</span> <span class="n">verificacion</span><span class="o">.</span><span class="n">cattle_id</span> <span class="o">==</span> <span class="n">g</span><span class="o">.</span><span class="n">id</span> <span class="ow">and</span> <span class="n">verificacion</span><span class="o">.</span><span class="n">is_active</span><span class="p">:</span>
						<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;verificacion&quot;: &quot;True&quot;&#39;</span>
					<span class="k">else</span><span class="p">:</span>
						<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;verificacion&quot;: &quot;False&quot;&#39;</span>

			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;}}&#39;</span>
		<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;]&#39;</span>

	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">	reigistros = LoadTest.objects.all()</span>
<span class="sd">	datas = serializers.serialize(&#39;json&#39;, reigistros, indent=2)</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">mimetype</span><span class="o">=</span><span class="s">&#39;application/json&#39;</span><span class="p">)</span>

<span class="c"># ------------------------------------------------------------</span>
<span class="c"># WORMER</span>
<span class="c"># ------------------------------------------------------------</span></div>
<span class="nd">@login_required</span>
<div class="viewcode-block" id="wsWormer_view"><a class="viewcode-back" href="../../../webServices.wsGanados.html#webServices.wsGanados.views.wsWormer_view">[documentos]</a><span class="k">def</span> <span class="nf">wsWormer_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
	<span class="n">search</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="p">[</span><span class="s">&#39;search&#39;</span><span class="p">]</span>
	<span class="n">user</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
	<span class="n">ganaderia</span> <span class="o">=</span> <span class="n">Ganaderia</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">perfil</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">	datas = serializers.serialize(&#39;json&#39;, Medicament.objects.filter(</span>
<span class="sd">				  (	Q(farm=ganaderia, is_wormer=True) &amp;</span>
<span class="sd">				  	Q(name__icontains=search)</span>
<span class="sd">				  ) </span>
<span class="sd">	))</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="n">datas</span> <span class="o">=</span> <span class="n">Medicament</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
										<span class="p">(</span>
											<span class="n">Q</span><span class="p">(</span><span class="n">is_wormer</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">farm</span><span class="o">=</span><span class="n">ganaderia</span><span class="p">)</span>
										<span class="p">)</span> <span class="o">&amp;</span> 
										<span class="p">(</span><span class="n">Q</span><span class="p">(</span><span class="n">expiration_date__icontains</span><span class="o">=</span><span class="n">search</span><span class="p">)</span> <span class="o">|</span>
										<span class="n">Q</span><span class="p">(</span><span class="n">name__icontains</span><span class="o">=</span><span class="n">search</span><span class="p">))</span>
									<span class="p">)</span>
	<span class="n">data</span> <span class="o">=</span> <span class="s">&#39;[&#39;</span>
	<span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">datas</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">data</span> <span class="o">==</span> <span class="s">&#39;[&#39;</span><span class="p">:</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;{&quot;pk&quot;: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;, &#39;</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;,{&quot;pk&quot;: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;, &#39;</span>
		<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;&quot;fields&quot;: {&#39;</span>
		<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;&quot;name&quot;: &quot;&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span><span class="s">&#39;&quot;&#39;</span>
		<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;expiration_date&quot;: &quot;&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">expiration_date</span><span class="p">)</span> <span class="o">+</span><span class="s">&#39;&quot;&#39;</span>
		<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;sex&quot;: &quot;&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">sex</span><span class="p">)</span> <span class="o">+</span><span class="s">&#39;&quot;&#39;</span>
		<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;amount&quot;: &quot;&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">amount</span><span class="p">)</span> <span class="o">+</span><span class="s">&#39;&quot;&#39;</span>
		<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;unit&quot;: &quot;&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span> <span class="o">+</span><span class="s">&#39;&quot;&#39;</span>
		

		<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;}}&#39;</span>
	<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;]&#39;</span>

	<span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">mimetype</span><span class="o">=</span><span class="s">&#39;application/json&#39;</span><span class="p">)</span>
</div>
<span class="nd">@login_required</span>
<div class="viewcode-block" id="ajaxVaccine_view"><a class="viewcode-back" href="../../../webServices.wsGanados.html#webServices.wsGanados.views.ajaxVaccine_view">[documentos]</a><span class="k">def</span> <span class="nf">ajaxVaccine_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
	<span class="n">search</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="p">[</span><span class="s">&#39;search&#39;</span><span class="p">]</span>
	<span class="n">user</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
	<span class="n">ganaderia</span> <span class="o">=</span> <span class="n">Ganaderia</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">perfil</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>
	
	<span class="n">medicaments</span> <span class="o">=</span> <span class="n">Medicament</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
										<span class="p">(</span>
											<span class="n">Q</span><span class="p">(</span><span class="n">is_vaccine</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">farm</span><span class="o">=</span><span class="n">ganaderia</span><span class="p">)</span>
										<span class="p">)</span> <span class="o">&amp;</span> 
										<span class="p">(</span><span class="n">Q</span><span class="p">(</span><span class="n">expiration_date__icontains</span><span class="o">=</span><span class="n">search</span><span class="p">)</span> <span class="o">|</span>
										<span class="n">Q</span><span class="p">(</span><span class="n">name__icontains</span><span class="o">=</span><span class="n">search</span><span class="p">))</span>
									<span class="p">)</span>
	<span class="n">data</span> <span class="o">=</span> <span class="s">&#39;[&#39;</span>
	<span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">medicaments</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">data</span> <span class="o">==</span> <span class="s">&#39;[&#39;</span><span class="p">:</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;{&quot;pk&quot;: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;, &#39;</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;,{&quot;pk&quot;: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;, &#39;</span>
		<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;&quot;fields&quot;: {&#39;</span>
		<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;&quot;name&quot;: &quot;&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span><span class="s">&#39;&quot;&#39;</span>
		<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;expiration_date&quot;: &quot;&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">expiration_date</span><span class="p">)</span> <span class="o">+</span><span class="s">&#39;&quot;&#39;</span>
		<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;sex&quot;: &quot;&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">sex</span><span class="p">)</span> <span class="o">+</span><span class="s">&#39;&quot;&#39;</span>
		<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;amount&quot;: &quot;&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">amount</span><span class="p">)</span> <span class="o">+</span><span class="s">&#39;&quot;&#39;</span>
		<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;unit&quot;: &quot;&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span> <span class="o">+</span><span class="s">&#39;&quot;&#39;</span>
		<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;}}&#39;</span>
	<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;]&#39;</span>
	
	<span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">mimetype</span><span class="o">=</span><span class="s">&#39;application/json&#39;</span><span class="p">)</span>
</div>
<span class="nd">@login_required</span>
<div class="viewcode-block" id="ajaxFood_view"><a class="viewcode-back" href="../../../webServices.wsGanados.html#webServices.wsGanados.views.ajaxFood_view">[documentos]</a><span class="k">def</span> <span class="nf">ajaxFood_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
	<span class="n">search</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="p">[</span><span class="s">&#39;search&#39;</span><span class="p">]</span>
	<span class="n">user</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
	<span class="n">ganaderia</span> <span class="o">=</span> <span class="n">Ganaderia</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">perfil</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>
	
	<span class="n">foods</span> <span class="o">=</span> <span class="n">Food</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
										<span class="p">(</span>
											<span class="n">Q</span><span class="p">(</span><span class="n">farm</span><span class="o">=</span><span class="n">ganaderia</span><span class="p">)</span>
										<span class="p">)</span> <span class="o">&amp;</span> 
										<span class="p">(</span><span class="n">Q</span><span class="p">(</span><span class="n">expiration_date__icontains</span><span class="o">=</span><span class="n">search</span><span class="p">)</span> <span class="o">|</span>
										<span class="n">Q</span><span class="p">(</span><span class="n">name__icontains</span><span class="o">=</span><span class="n">search</span><span class="p">))</span>
									<span class="p">)</span>
	
	<span class="n">data</span> <span class="o">=</span> <span class="s">&#39;[&#39;</span>
	<span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">foods</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">data</span> <span class="o">==</span> <span class="s">&#39;[&#39;</span><span class="p">:</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;{&quot;pk&quot;: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;, &#39;</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;,{&quot;pk&quot;: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;, &#39;</span>
		<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;&quot;fields&quot;: {&#39;</span>
		<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;&quot;name&quot;: &quot;&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span><span class="s">&#39;&quot;&#39;</span>
		<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;expiration_date&quot;: &quot;&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">expiration_date</span><span class="p">)</span> <span class="o">+</span><span class="s">&#39;&quot;&#39;</span>
		<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;phase&quot;: &quot;&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">phase</span><span class="p">)</span> <span class="o">+</span><span class="s">&#39;&quot;&#39;</span>
		<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;amount&quot;: &quot;&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">amount</span><span class="p">)</span> <span class="o">+</span><span class="s">&#39;&quot;&#39;</span>
		<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;unit&quot;: &quot;&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span> <span class="o">+</span><span class="s">&#39;&quot;&#39;</span>
		<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;}}&#39;</span>
	<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;]&#39;</span>
	
	<span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">mimetype</span><span class="o">=</span><span class="s">&#39;application/json&#39;</span><span class="p">)</span>

</div>
<span class="nd">@login_required</span>
<div class="viewcode-block" id="ajaxAssignCattleVaccine_view"><a class="viewcode-back" href="../../../webServices.wsGanados.html#webServices.wsGanados.views.ajaxAssignCattleVaccine_view">[documentos]</a><span class="k">def</span> <span class="nf">ajaxAssignCattleVaccine_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
	<span class="n">search</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="p">[</span><span class="s">&#39;search&#39;</span><span class="p">]</span>
	<span class="n">listCattle</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="p">[</span><span class="s">&#39;listCattle&#39;</span><span class="p">])</span>
	<span class="n">user</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
	<span class="n">ganaderia</span> <span class="o">=</span> <span class="n">Ganaderia</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">perfil</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>
	
	<span class="k">if</span> <span class="n">ganaderia</span><span class="o">.</span><span class="n">configuracion</span><span class="o">.</span><span class="n">tipo_identificacion</span> <span class="o">==</span> <span class="s">&#39;simple&#39;</span><span class="p">:</span>
		<span class="n">ganados</span> <span class="o">=</span> <span class="n">Ganado</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
											<span class="n">Q</span><span class="p">(</span><span class="n">ganaderia</span><span class="o">=</span><span class="n">ganaderia</span><span class="p">)</span> <span class="o">&amp;</span>
											<span class="p">(</span>
												<span class="n">Q</span><span class="p">(</span><span class="n">nacimiento__icontains</span><span class="o">=</span><span class="n">search</span><span class="p">)</span> <span class="o">|</span>
												<span class="n">Q</span><span class="p">(</span><span class="n">identificacion_simple__nombre__icontains</span><span class="o">=</span><span class="n">search</span><span class="p">)</span> <span class="o">|</span>
												<span class="n">Q</span><span class="p">(</span><span class="n">identificacion_simple__rp__icontains</span><span class="o">=</span><span class="n">search</span><span class="p">)</span>
											<span class="p">)</span>
										<span class="p">)</span>
		<span class="c"># serializando</span>
		<span class="n">data</span> <span class="o">=</span> <span class="s">&#39;[&#39;</span>
		<span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">ganados</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">data</span> <span class="o">==</span> <span class="s">&#39;[&#39;</span><span class="p">:</span>
				<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;{&quot;pk&quot;: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;, &#39;</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;,{&quot;pk&quot;: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;, &#39;</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;&quot;fields&quot;: {&#39;</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;&quot;rp&quot;: &quot;&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">identificacion_simple</span><span class="o">.</span><span class="n">rp</span><span class="p">)</span> <span class="o">+</span><span class="s">&#39;&quot;&#39;</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;imagen&quot;: &quot;&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">imagen</span><span class="p">)</span> <span class="o">+</span><span class="s">&#39;&quot;&#39;</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;nombre&quot;: &quot;&#39;</span><span class="o">+</span> <span class="n">g</span><span class="o">.</span><span class="n">identificacion_simple</span><span class="o">.</span><span class="n">nombre</span> <span class="o">+</span><span class="s">&#39;&quot;&#39;</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;edad_anios&quot;: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">edad_anios</span> <span class="p">)</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;edad_meses&quot;: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">edad_meses</span> <span class="p">)</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;edad_dias&quot;: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">edad_dias</span> <span class="p">)</span>

			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;}}&#39;</span>
		<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;]&#39;</span>

	<span class="k">else</span><span class="p">:</span>
		<span class="n">ganados</span> <span class="o">=</span> <span class="n">Ganado</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
											<span class="n">Q</span><span class="p">(</span><span class="n">ganaderia</span><span class="o">=</span><span class="n">ganaderia</span><span class="p">)</span> <span class="o">&amp;</span>
											<span class="p">(</span>
												<span class="n">Q</span><span class="p">(</span><span class="n">nacimiento__icontains</span><span class="o">=</span><span class="n">search</span><span class="p">)</span> <span class="o">|</span>
												<span class="n">Q</span><span class="p">(</span><span class="n">identificacion_ecuador__nombre__icontains</span><span class="o">=</span><span class="n">search</span><span class="p">)</span> <span class="o">|</span>
												<span class="n">Q</span><span class="p">(</span><span class="n">identificacion_ecuador__rp__icontains</span><span class="o">=</span><span class="n">search</span><span class="p">)</span>
											<span class="p">)</span>
										<span class="p">)</span>
		<span class="c"># serializando</span>
		<span class="n">data</span> <span class="o">=</span> <span class="s">&#39;[&#39;</span>
		<span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">ganados</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">data</span> <span class="o">==</span> <span class="s">&#39;[&#39;</span><span class="p">:</span>
				<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;{&quot;pk&quot;: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;, &#39;</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;,{&quot;pk&quot;: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;, &#39;</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;&quot;fields&quot;: {&#39;</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;&quot;rp&quot;: &quot;&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">identificacion_ecuador</span><span class="o">.</span><span class="n">rp</span><span class="p">)</span> <span class="o">+</span><span class="s">&#39;&quot;&#39;</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;imagen&quot;: &quot;&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">imagen</span><span class="p">)</span> <span class="o">+</span><span class="s">&#39;&quot;&#39;</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;nombre&quot;: &quot;&#39;</span><span class="o">+</span> <span class="n">g</span><span class="o">.</span><span class="n">identificacion_ecuador</span><span class="o">.</span><span class="n">nombre</span> <span class="o">+</span><span class="s">&#39;&quot;&#39;</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;edad_anios&quot;: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">edad_anios</span> <span class="p">)</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;edad_meses&quot;: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">edad_meses</span> <span class="p">)</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;edad_dias&quot;: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">edad_dias</span> <span class="p">)</span>

			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;}}&#39;</span>
		<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;]&#39;</span>

	<span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">mimetype</span><span class="o">=</span><span class="s">&#39;application/json&#39;</span><span class="p">)</span>

</div>
<span class="nd">@login_required</span>
<div class="viewcode-block" id="ajaxAssignCattleVaccineFinal"><a class="viewcode-back" href="../../../webServices.wsGanados.html#webServices.wsGanados.views.ajaxAssignCattleVaccineFinal">[documentos]</a><span class="k">def</span> <span class="nf">ajaxAssignCattleVaccineFinal</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
	<span class="n">id_wormer</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="p">[</span><span class="s">&#39;id_vaccine&#39;</span><span class="p">]</span>
	<span class="n">listCattle</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="p">[</span><span class="s">&#39;listCattle&#39;</span><span class="p">])</span>
	<span class="n">user</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
	<span class="n">ganaderia</span> <span class="o">=</span> <span class="n">Ganaderia</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">perfil</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>
	<span class="n">wormer</span> <span class="o">=</span> <span class="n">Medicament</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_wormer</span><span class="p">)</span>
	<span class="n">listCattle</span> <span class="o">=</span> <span class="n">listCattle</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;[&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span>
	<span class="n">listCattle</span> <span class="o">=</span> <span class="n">listCattle</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;]&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span>
	<span class="n">listCattle</span> <span class="o">=</span> <span class="n">listCattle</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span>
	<span class="n">listCattle</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">listCattle</span><span class="p">)</span>

	<span class="n">date_now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>
	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">listCattle</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
		<span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">listCattle</span><span class="p">)</span> <span class="o">*</span> <span class="n">wormer</span><span class="o">.</span><span class="n">amount_application</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">wormer</span><span class="o">.</span><span class="n">amount</span><span class="p">:</span>
			<span class="n">application_wormer</span> <span class="o">=</span> <span class="n">ApplicationMedicament</span><span class="p">()</span>
			<span class="n">application_wormer</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="n">date_now</span>
			<span class="n">application_wormer</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="mi">0</span>
			<span class="n">application_wormer</span><span class="o">.</span><span class="n">medicament</span> <span class="o">=</span> <span class="n">wormer</span>
			<span class="n">application_wormer</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
			<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">listCattle</span><span class="p">)):</span>
				<span class="n">application_wormer</span><span class="o">.</span><span class="n">cattle</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">listCattle</span><span class="p">[</span><span class="n">c</span><span class="p">])</span>
			<span class="n">wormer</span><span class="o">.</span><span class="n">amount</span><span class="o">=</span><span class="n">wormer</span><span class="o">.</span><span class="n">amount</span> <span class="o">-</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">listCattle</span><span class="p">)</span><span class="o">*</span><span class="n">wormer</span><span class="o">.</span><span class="n">amount_application</span><span class="p">)</span>
			<span class="n">wormer</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
			<span class="n">data</span> <span class="o">=</span> <span class="s">&#39;[ { &quot;state&quot;: 0} ]&#39;</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">wormer</span><span class="o">.</span><span class="n">unit</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
				<span class="n">unit_display</span> <span class="o">=</span> <span class="s">&#39;ml&#39;</span>
			<span class="k">elif</span> <span class="n">wormer</span><span class="o">.</span><span class="n">unit</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> 
				<span class="n">unit_display</span><span class="o">=</span><span class="s">&#39;gr&#39;</span>
			<span class="k">elif</span> <span class="n">wormer</span><span class="o">.</span><span class="n">unit</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span> 
				<span class="n">unit_display</span><span class="o">=</span><span class="s">&#39;lbs&#39;</span> 
			<span class="k">elif</span> <span class="n">wormer</span><span class="o">.</span><span class="n">unit</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span> 
				<span class="n">unit_display</span><span class="o">=</span><span class="s">&#39;kg&#39;</span> 
			<span class="k">elif</span> <span class="n">wormer</span><span class="o">.</span><span class="n">unit</span><span class="o">==</span><span class="mi">4</span><span class="p">:</span> 
				<span class="n">unit_display</span><span class="o">=</span><span class="s">&#39;paquetes&#39;</span>
			<span class="n">data</span> <span class="o">=</span> <span class="s">&#39;[ {&quot;state&quot;: 1, &quot;amount&quot;:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">wormer</span><span class="o">.</span><span class="n">amount</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;, &quot;amount_now&quot;: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">listCattle</span><span class="p">)</span><span class="o">*</span><span class="n">wormer</span><span class="o">.</span><span class="n">amount_application</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;, &quot;unit&quot;: &quot;&#39;</span><span class="o">+</span><span class="n">unit_display</span><span class="o">+</span><span class="s">&#39;&quot; , &quot;consumer_amount&quot;: &quot;&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">wormer</span><span class="o">.</span><span class="n">amount_application</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;&quot;}]&#39;</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">data</span> <span class="o">=</span> <span class="s">&#39;[ { &quot;state&quot;: 2} ]&#39;</span>

	<span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">mimetype</span><span class="o">=</span><span class="s">&#39;application/json&#39;</span><span class="p">)</span>


</div>
<span class="nd">@login_required</span>
<div class="viewcode-block" id="ajaxAssignCattleWormer_view"><a class="viewcode-back" href="../../../webServices.wsGanados.html#webServices.wsGanados.views.ajaxAssignCattleWormer_view">[documentos]</a><span class="k">def</span> <span class="nf">ajaxAssignCattleWormer_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
	<span class="n">search</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="p">[</span><span class="s">&#39;search&#39;</span><span class="p">]</span>
	<span class="n">listCattle</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="p">[</span><span class="s">&#39;listCattle&#39;</span><span class="p">])</span>
	<span class="n">user</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
	<span class="n">ganaderia</span> <span class="o">=</span> <span class="n">Ganaderia</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">perfil</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>
	
	<span class="k">if</span> <span class="n">ganaderia</span><span class="o">.</span><span class="n">configuracion</span><span class="o">.</span><span class="n">tipo_identificacion</span> <span class="o">==</span> <span class="s">&#39;simple&#39;</span><span class="p">:</span>
		<span class="n">ganados</span> <span class="o">=</span> <span class="n">Ganado</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
											<span class="n">Q</span><span class="p">(</span><span class="n">ganaderia</span><span class="o">=</span><span class="n">ganaderia</span><span class="p">)</span> <span class="o">&amp;</span>
											<span class="p">(</span>
												<span class="n">Q</span><span class="p">(</span><span class="n">nacimiento__icontains</span><span class="o">=</span><span class="n">search</span><span class="p">)</span> <span class="o">|</span>
												<span class="n">Q</span><span class="p">(</span><span class="n">identificacion_simple__nombre__icontains</span><span class="o">=</span><span class="n">search</span><span class="p">)</span> <span class="o">|</span>
												<span class="n">Q</span><span class="p">(</span><span class="n">identificacion_simple__rp__icontains</span><span class="o">=</span><span class="n">search</span><span class="p">)</span>
											<span class="p">)</span>
										<span class="p">)</span>
		<span class="c"># serializando</span>
		<span class="n">data</span> <span class="o">=</span> <span class="s">&#39;[&#39;</span>
		<span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">ganados</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">data</span> <span class="o">==</span> <span class="s">&#39;[&#39;</span><span class="p">:</span>
				<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;{&quot;pk&quot;: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;, &#39;</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;,{&quot;pk&quot;: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;, &#39;</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;&quot;fields&quot;: {&#39;</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;&quot;rp&quot;: &quot;&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">identificacion_simple</span><span class="o">.</span><span class="n">rp</span><span class="p">)</span> <span class="o">+</span><span class="s">&#39;&quot;&#39;</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;imagen&quot;: &quot;&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">imagen</span><span class="p">)</span> <span class="o">+</span><span class="s">&#39;&quot;&#39;</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;nombre&quot;: &quot;&#39;</span><span class="o">+</span> <span class="n">g</span><span class="o">.</span><span class="n">identificacion_simple</span><span class="o">.</span><span class="n">nombre</span> <span class="o">+</span><span class="s">&#39;&quot;&#39;</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;edad_anios&quot;: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">edad_anios</span> <span class="p">)</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;edad_meses&quot;: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">edad_meses</span> <span class="p">)</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;edad_dias&quot;: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">edad_dias</span> <span class="p">)</span>

			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;}}&#39;</span>
		<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;]&#39;</span>

	<span class="k">else</span><span class="p">:</span>
		<span class="n">ganados</span> <span class="o">=</span> <span class="n">Ganado</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
											<span class="n">Q</span><span class="p">(</span><span class="n">ganaderia</span><span class="o">=</span><span class="n">ganaderia</span><span class="p">)</span> <span class="o">&amp;</span>
											<span class="p">(</span>
												<span class="n">Q</span><span class="p">(</span><span class="n">nacimiento__icontains</span><span class="o">=</span><span class="n">search</span><span class="p">)</span> <span class="o">|</span>
												<span class="n">Q</span><span class="p">(</span><span class="n">identificacion_ecuador__nombre__icontains</span><span class="o">=</span><span class="n">search</span><span class="p">)</span> <span class="o">|</span>
												<span class="n">Q</span><span class="p">(</span><span class="n">identificacion_ecuador__rp__icontains</span><span class="o">=</span><span class="n">search</span><span class="p">)</span>
											<span class="p">)</span>
										<span class="p">)</span>
		<span class="c"># serializando</span>
		<span class="n">data</span> <span class="o">=</span> <span class="s">&#39;[&#39;</span>
		<span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">ganados</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">data</span> <span class="o">==</span> <span class="s">&#39;[&#39;</span><span class="p">:</span>
				<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;{&quot;pk&quot;: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;, &#39;</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;,{&quot;pk&quot;: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;, &#39;</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;&quot;fields&quot;: {&#39;</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;&quot;rp&quot;: &quot;&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">identificacion_ecuador</span><span class="o">.</span><span class="n">rp</span><span class="p">)</span> <span class="o">+</span><span class="s">&#39;&quot;&#39;</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;imagen&quot;: &quot;&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">imagen</span><span class="p">)</span> <span class="o">+</span><span class="s">&#39;&quot;&#39;</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;nombre&quot;: &quot;&#39;</span><span class="o">+</span> <span class="n">g</span><span class="o">.</span><span class="n">identificacion_ecuador</span><span class="o">.</span><span class="n">nombre</span> <span class="o">+</span><span class="s">&#39;&quot;&#39;</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;edad_anios&quot;: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">edad_anios</span> <span class="p">)</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;edad_meses&quot;: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">edad_meses</span> <span class="p">)</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;edad_dias&quot;: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">edad_dias</span> <span class="p">)</span>

			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;}}&#39;</span>
		<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;]&#39;</span>

	<span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">mimetype</span><span class="o">=</span><span class="s">&#39;application/json&#39;</span><span class="p">)</span>
</div>
<span class="nd">@login_required</span>
<div class="viewcode-block" id="ajaxAssignCattleWormerFinal"><a class="viewcode-back" href="../../../webServices.wsGanados.html#webServices.wsGanados.views.ajaxAssignCattleWormerFinal">[documentos]</a><span class="k">def</span> <span class="nf">ajaxAssignCattleWormerFinal</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
	<span class="n">id_wormer</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="p">[</span><span class="s">&#39;id_wormer&#39;</span><span class="p">]</span>
	<span class="n">listCattle</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="p">[</span><span class="s">&#39;listCattle&#39;</span><span class="p">])</span>
	<span class="n">user</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
	<span class="n">ganaderia</span> <span class="o">=</span> <span class="n">Ganaderia</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">perfil</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>
	<span class="n">wormer</span> <span class="o">=</span> <span class="n">Medicament</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_wormer</span><span class="p">)</span>
	<span class="n">listCattle</span> <span class="o">=</span> <span class="n">listCattle</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;[&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span>
	<span class="n">listCattle</span> <span class="o">=</span> <span class="n">listCattle</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;]&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span>
	<span class="n">listCattle</span> <span class="o">=</span> <span class="n">listCattle</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span>
	<span class="n">listCattle</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">listCattle</span><span class="p">)</span>

	<span class="n">date_now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>
	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">listCattle</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
		<span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">listCattle</span><span class="p">)</span> <span class="o">*</span> <span class="n">wormer</span><span class="o">.</span><span class="n">amount_application</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">wormer</span><span class="o">.</span><span class="n">amount</span><span class="p">:</span>
			<span class="n">application_wormer</span> <span class="o">=</span> <span class="n">ApplicationMedicament</span><span class="p">()</span>
			<span class="n">application_wormer</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="n">date_now</span>
			<span class="n">application_wormer</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="mi">0</span>
			<span class="n">application_wormer</span><span class="o">.</span><span class="n">medicament</span> <span class="o">=</span> <span class="n">wormer</span>
			<span class="n">application_wormer</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
			<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">listCattle</span><span class="p">)):</span>
				<span class="n">application_wormer</span><span class="o">.</span><span class="n">cattle</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">listCattle</span><span class="p">[</span><span class="n">c</span><span class="p">])</span>
			<span class="n">wormer</span><span class="o">.</span><span class="n">amount</span><span class="o">=</span><span class="n">wormer</span><span class="o">.</span><span class="n">amount</span> <span class="o">-</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">listCattle</span><span class="p">)</span><span class="o">*</span><span class="n">wormer</span><span class="o">.</span><span class="n">amount_application</span><span class="p">)</span>
			<span class="n">wormer</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
			<span class="n">data</span> <span class="o">=</span> <span class="s">&#39;[ { &quot;state&quot;: 0} ]&#39;</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">wormer</span><span class="o">.</span><span class="n">unit</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
				<span class="n">unit_display</span> <span class="o">=</span> <span class="s">&#39;ml&#39;</span>
			<span class="k">elif</span> <span class="n">wormer</span><span class="o">.</span><span class="n">unit</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> 
				<span class="n">unit_display</span><span class="o">=</span><span class="s">&#39;gr&#39;</span>
			<span class="k">elif</span> <span class="n">wormer</span><span class="o">.</span><span class="n">unit</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span> 
				<span class="n">unit_display</span><span class="o">=</span><span class="s">&#39;lbs&#39;</span> 
			<span class="k">elif</span> <span class="n">wormer</span><span class="o">.</span><span class="n">unit</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span> 
				<span class="n">unit_display</span><span class="o">=</span><span class="s">&#39;kg&#39;</span> 
			<span class="k">elif</span> <span class="n">wormer</span><span class="o">.</span><span class="n">unit</span><span class="o">==</span><span class="mi">4</span><span class="p">:</span> 
				<span class="n">unit_display</span><span class="o">=</span><span class="s">&#39;paquetes&#39;</span>
			<span class="n">data</span> <span class="o">=</span> <span class="s">&#39;[ {&quot;state&quot;: 1, &quot;amount&quot;:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">wormer</span><span class="o">.</span><span class="n">amount</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;, &quot;amount_now&quot;: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">listCattle</span><span class="p">)</span><span class="o">*</span><span class="n">wormer</span><span class="o">.</span><span class="n">amount_application</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;, &quot;unit&quot;: &quot;&#39;</span><span class="o">+</span><span class="n">unit_display</span><span class="o">+</span><span class="s">&#39;&quot; , &quot;consumer_amount&quot;: &quot;&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">wormer</span><span class="o">.</span><span class="n">amount_application</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;&quot;}]&#39;</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">data</span> <span class="o">=</span> <span class="s">&#39;[ { &quot;state&quot;: 2} ]&#39;</span>

	<span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">mimetype</span><span class="o">=</span><span class="s">&#39;application/json&#39;</span><span class="p">)</span>


</div>
<span class="nd">@login_required</span>
<div class="viewcode-block" id="ajaxAssignCattleFood_view"><a class="viewcode-back" href="../../../webServices.wsGanados.html#webServices.wsGanados.views.ajaxAssignCattleFood_view">[documentos]</a><span class="k">def</span> <span class="nf">ajaxAssignCattleFood_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
	<span class="n">search</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="p">[</span><span class="s">&#39;search&#39;</span><span class="p">]</span>
	<span class="n">listCattle</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="p">[</span><span class="s">&#39;listCattle&#39;</span><span class="p">])</span>
	<span class="n">user</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
	<span class="n">ganaderia</span> <span class="o">=</span> <span class="n">Ganaderia</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">perfil</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>
	
	<span class="k">if</span> <span class="n">ganaderia</span><span class="o">.</span><span class="n">configuracion</span><span class="o">.</span><span class="n">tipo_identificacion</span> <span class="o">==</span> <span class="s">&#39;simple&#39;</span><span class="p">:</span>
		<span class="n">ganados</span> <span class="o">=</span> <span class="n">Ganado</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
											<span class="n">Q</span><span class="p">(</span><span class="n">ganaderia</span><span class="o">=</span><span class="n">ganaderia</span><span class="p">)</span> <span class="o">&amp;</span>
											<span class="p">(</span>
												<span class="n">Q</span><span class="p">(</span><span class="n">nacimiento__icontains</span><span class="o">=</span><span class="n">search</span><span class="p">)</span> <span class="o">|</span>
												<span class="n">Q</span><span class="p">(</span><span class="n">identificacion_simple__nombre__icontains</span><span class="o">=</span><span class="n">search</span><span class="p">)</span> <span class="o">|</span>
												<span class="n">Q</span><span class="p">(</span><span class="n">identificacion_simple__rp__icontains</span><span class="o">=</span><span class="n">search</span><span class="p">)</span>
											<span class="p">)</span>
										<span class="p">)</span>
		<span class="c"># serializando</span>
		<span class="n">data</span> <span class="o">=</span> <span class="s">&#39;[&#39;</span>
		<span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">ganados</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">data</span> <span class="o">==</span> <span class="s">&#39;[&#39;</span><span class="p">:</span>
				<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;{&quot;pk&quot;: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;, &#39;</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;,{&quot;pk&quot;: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;, &#39;</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;&quot;fields&quot;: {&#39;</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;&quot;rp&quot;: &quot;&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">identificacion_simple</span><span class="o">.</span><span class="n">rp</span><span class="p">)</span> <span class="o">+</span><span class="s">&#39;&quot;&#39;</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;imagen&quot;: &quot;&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">imagen</span><span class="p">)</span> <span class="o">+</span><span class="s">&#39;&quot;&#39;</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;nombre&quot;: &quot;&#39;</span><span class="o">+</span> <span class="n">g</span><span class="o">.</span><span class="n">identificacion_simple</span><span class="o">.</span><span class="n">nombre</span> <span class="o">+</span><span class="s">&#39;&quot;&#39;</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;edad_anios&quot;: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">edad_anios</span> <span class="p">)</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;edad_meses&quot;: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">edad_meses</span> <span class="p">)</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;edad_dias&quot;: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">edad_dias</span> <span class="p">)</span>

			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;}}&#39;</span>
		<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;]&#39;</span>

	<span class="k">else</span><span class="p">:</span>
		<span class="n">ganados</span> <span class="o">=</span> <span class="n">Ganado</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
											<span class="n">Q</span><span class="p">(</span><span class="n">ganaderia</span><span class="o">=</span><span class="n">ganaderia</span><span class="p">)</span> <span class="o">&amp;</span>
											<span class="p">(</span>
												<span class="n">Q</span><span class="p">(</span><span class="n">nacimiento__icontains</span><span class="o">=</span><span class="n">search</span><span class="p">)</span> <span class="o">|</span>
												<span class="n">Q</span><span class="p">(</span><span class="n">identificacion_ecuador__nombre__icontains</span><span class="o">=</span><span class="n">search</span><span class="p">)</span> <span class="o">|</span>
												<span class="n">Q</span><span class="p">(</span><span class="n">identificacion_ecuador__rp__icontains</span><span class="o">=</span><span class="n">search</span><span class="p">)</span>
											<span class="p">)</span>
										<span class="p">)</span>
		<span class="c"># serializando</span>
		<span class="n">data</span> <span class="o">=</span> <span class="s">&#39;[&#39;</span>
		<span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">ganados</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">data</span> <span class="o">==</span> <span class="s">&#39;[&#39;</span><span class="p">:</span>
				<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;{&quot;pk&quot;: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;, &#39;</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;,{&quot;pk&quot;: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;, &#39;</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;&quot;fields&quot;: {&#39;</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;&quot;rp&quot;: &quot;&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">identificacion_ecuador</span><span class="o">.</span><span class="n">rp</span><span class="p">)</span> <span class="o">+</span><span class="s">&#39;&quot;&#39;</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;imagen&quot;: &quot;&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">imagen</span><span class="p">)</span> <span class="o">+</span><span class="s">&#39;&quot;&#39;</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;nombre&quot;: &quot;&#39;</span><span class="o">+</span> <span class="n">g</span><span class="o">.</span><span class="n">identificacion_ecuador</span><span class="o">.</span><span class="n">nombre</span> <span class="o">+</span><span class="s">&#39;&quot;&#39;</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;edad_anios&quot;: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">edad_anios</span> <span class="p">)</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;edad_meses&quot;: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">edad_meses</span> <span class="p">)</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;, &quot;edad_dias&quot;: &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">edad_dias</span> <span class="p">)</span>

			<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;}}&#39;</span>
		<span class="n">data</span> <span class="o">+=</span> <span class="s">&#39;]&#39;</span>

	<span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">mimetype</span><span class="o">=</span><span class="s">&#39;application/json&#39;</span><span class="p">)</span>


</div>
<span class="nd">@login_required</span>
<div class="viewcode-block" id="ajaxAssignCattleFoodFinal"><a class="viewcode-back" href="../../../webServices.wsGanados.html#webServices.wsGanados.views.ajaxAssignCattleFoodFinal">[documentos]</a><span class="k">def</span> <span class="nf">ajaxAssignCattleFoodFinal</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
	<span class="n">id_food</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="p">[</span><span class="s">&#39;id_food&#39;</span><span class="p">]</span>
	<span class="n">listCattle</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="p">[</span><span class="s">&#39;listCattle&#39;</span><span class="p">])</span>
	<span class="n">user</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
	<span class="n">ganaderia</span> <span class="o">=</span> <span class="n">Ganaderia</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">perfil</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>
	<span class="n">food</span> <span class="o">=</span> <span class="n">Food</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_food</span><span class="p">)</span>
	<span class="n">listCattle</span> <span class="o">=</span> <span class="n">listCattle</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;[&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span>
	<span class="n">listCattle</span> <span class="o">=</span> <span class="n">listCattle</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;]&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span>
	<span class="n">listCattle</span> <span class="o">=</span> <span class="n">listCattle</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span>
	<span class="n">listCattle</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">listCattle</span><span class="p">)</span>

	<span class="n">date_now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>
	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">listCattle</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
		<span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">listCattle</span><span class="p">)</span> <span class="o">*</span> <span class="n">food</span><span class="o">.</span><span class="n">consumer_amount</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">food</span><span class="o">.</span><span class="n">amount</span><span class="p">:</span>
			<span class="n">application_food</span> <span class="o">=</span> <span class="n">ApplicationFood</span><span class="p">()</span>
			<span class="n">application_food</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="n">date_now</span>
			<span class="n">application_food</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="mi">0</span>
			<span class="n">application_food</span><span class="o">.</span><span class="n">food</span> <span class="o">=</span> <span class="n">food</span>
			<span class="n">application_food</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
			<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">listCattle</span><span class="p">)):</span>
				<span class="n">application_food</span><span class="o">.</span><span class="n">cattle</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">listCattle</span><span class="p">[</span><span class="n">c</span><span class="p">])</span>
			<span class="n">food</span><span class="o">.</span><span class="n">amount</span><span class="o">=</span><span class="n">food</span><span class="o">.</span><span class="n">amount</span> <span class="o">-</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">listCattle</span><span class="p">)</span><span class="o">*</span><span class="n">food</span><span class="o">.</span><span class="n">consumer_amount</span><span class="p">)</span>
			<span class="n">food</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
			<span class="n">data</span> <span class="o">=</span> <span class="s">&#39;[ { &quot;state&quot;: 0} ]&#39;</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">food</span><span class="o">.</span><span class="n">unit</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
				<span class="n">unit_display</span> <span class="o">=</span> <span class="s">&#39;ml&#39;</span>
			<span class="k">elif</span> <span class="n">food</span><span class="o">.</span><span class="n">unit</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> 
				<span class="n">unit_display</span><span class="o">=</span><span class="s">&#39;gr&#39;</span>
			<span class="k">elif</span> <span class="n">food</span><span class="o">.</span><span class="n">unit</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span> 
				<span class="n">unit_display</span><span class="o">=</span><span class="s">&#39;lbs&#39;</span> 
			<span class="k">elif</span> <span class="n">food</span><span class="o">.</span><span class="n">unit</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span> 
				<span class="n">unit_display</span><span class="o">=</span><span class="s">&#39;kg&#39;</span> 
			<span class="k">elif</span> <span class="n">food</span><span class="o">.</span><span class="n">unit</span><span class="o">==</span><span class="mi">4</span><span class="p">:</span> 
				<span class="n">unit_display</span><span class="o">=</span><span class="s">&#39;paquetes&#39;</span>
			<span class="n">data</span> <span class="o">=</span> <span class="s">&#39;[ {&quot;state&quot;: 1, &quot;amount&quot;:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">food</span><span class="o">.</span><span class="n">amount</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;, &quot;amount_now&quot;: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">listCattle</span><span class="p">)</span><span class="o">*</span><span class="n">food</span><span class="o">.</span><span class="n">consumer_amount</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;, &quot;unit&quot;: &quot;&#39;</span><span class="o">+</span><span class="n">unit_display</span><span class="o">+</span><span class="s">&#39;&quot; , &quot;consumer_amount&quot;: &quot;&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">food</span><span class="o">.</span><span class="n">consumer_amount</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;&quot;}]&#39;</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">data</span> <span class="o">=</span> <span class="s">&#39;[ { &quot;state&quot;: 2} ]&#39;</span>

	<span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">mimetype</span><span class="o">=</span><span class="s">&#39;application/json&#39;</span><span class="p">)</span>

</div>
<span class="nd">@login_required</span>
<div class="viewcode-block" id="ajaxInsemination_view"><a class="viewcode-back" href="../../../webServices.wsGanados.html#webServices.wsGanados.views.ajaxInsemination_view">[documentos]</a><span class="k">def</span> <span class="nf">ajaxInsemination_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
	<span class="n">search</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="p">[</span><span class="s">&#39;search&#39;</span><span class="p">]</span>
	<span class="n">user</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
	<span class="n">farm</span> <span class="o">=</span> <span class="n">Ganaderia</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">perfil</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>

	<span class="n">data</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="s">&#39;json&#39;</span><span class="p">,</span> <span class="n">Insemination</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
				  <span class="p">(</span><span class="n">Q</span><span class="p">(</span><span class="n">farm</span><span class="o">=</span><span class="n">farm</span><span class="p">))</span> <span class="o">&amp;</span>
				  <span class="p">(</span>	<span class="n">Q</span><span class="p">(</span><span class="n">registration_date__icontains</span><span class="o">=</span><span class="n">search</span><span class="p">)</span> <span class="o">|</span>
				  	<span class="n">Q</span><span class="p">(</span><span class="n">rp__iexact</span><span class="o">=</span><span class="n">search</span><span class="p">)</span> <span class="o">|</span>
				  	<span class="n">Q</span><span class="p">(</span><span class="n">name__icontains</span><span class="o">=</span><span class="n">search</span><span class="p">)</span>
				  <span class="p">)</span> 
	<span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;-rp&#39;</span><span class="p">))</span>
	
	<span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">mimetype</span><span class="o">=</span><span class="s">&#39;application/json&#39;</span><span class="p">)</span>

</div>
<span class="kn">import</span> <span class="nn">spade</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="c">################################################</span>
<span class="c"># Agente Produccion</span>
<span class="c">################################################</span>
<div class="viewcode-block" id="DesireProduccion"><a class="viewcode-back" href="../../../webServices.wsGanados.html#webServices.wsGanados.views.DesireProduccion">[documentos]</a><span class="k">class</span> <span class="nc">DesireProduccion</span><span class="p">:</span>
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">desire_ordenio</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">user_name</span><span class="p">)</span>
		<span class="n">farm</span> <span class="o">=</span> <span class="n">Ganaderia</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">perfil</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>
		<span class="n">date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>
		<span class="n">cattle</span> <span class="o">=</span> <span class="n">Ganado</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">ganaderia</span><span class="o">=</span><span class="n">farm</span><span class="p">,</span> <span class="n">genero</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">etapas__nombre</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ciclos__nombre</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cattle</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">desire_ordenio</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="BeliefProduccion"><a class="viewcode-back" href="../../../webServices.wsGanados.html#webServices.wsGanados.views.BeliefProduccion">[documentos]</a><span class="k">class</span> <span class="nc">BeliefProduccion</span><span class="p">:</span>
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">belief1</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">belief1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="IntentionProduction"><a class="viewcode-back" href="../../../webServices.wsGanados.html#webServices.wsGanados.views.IntentionProduction">[documentos]</a><span class="k">class</span> <span class="nc">IntentionProduction</span><span class="p">:</span>
<div class="viewcode-block" id="IntentionProduction.assignNotification"><a class="viewcode-back" href="../../../webServices.wsGanados.html#webServices.wsGanados.views.IntentionProduction.assignNotification">[documentos]</a>	<span class="k">def</span> <span class="nf">assignNotification</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
		<span class="n">notification</span> <span class="o">=</span> <span class="n">Notification</span><span class="p">()</span>
		<span class="n">notification</span><span class="o">.</span><span class="n">start_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>
		<span class="n">notification</span><span class="o">.</span><span class="n">end_date</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
		<span class="n">notification</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="mi">2</span>
		<span class="n">notification</span><span class="o">.</span><span class="n">module</span> <span class="o">=</span> <span class="mi">3</span>
		<span class="n">cattle</span> <span class="o">=</span> <span class="n">Ganado</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">d</span><span class="p">)</span>
		<span class="n">notification</span><span class="o">.</span><span class="n">ident_cattle</span> <span class="o">=</span> <span class="n">cattle</span>
		<span class="n">notification</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="mi">5</span>
		<span class="n">notification</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="IntentionProduction.sendNotificationOrdenio"><a class="viewcode-back" href="../../../webServices.wsGanados.html#webServices.wsGanados.views.IntentionProduction.sendNotificationOrdenio">[documentos]</a>	<span class="k">def</span> <span class="nf">sendNotificationOrdenio</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">desire_ordenio</span><span class="p">):</span>
		<span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">user_name</span><span class="p">)</span>
		<span class="n">farm</span> <span class="o">=</span> <span class="n">Ganaderia</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">perfil</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>
		
		<span class="n">users</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">profile_user__ganaderia_perfil</span><span class="o">=</span><span class="n">farm</span><span class="p">)</span>

		<span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">desire_ordenio</span><span class="p">:</span>
			<span class="n">one_day_before</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span> <span class="o">-</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">notifi</span> <span class="o">=</span> <span class="n">Notification</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ident_cattle_id</span><span class="o">=</span><span class="n">d</span><span class="p">,</span> <span class="n">start_date</span><span class="o">=</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">())</span>
			<span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="n">notifi</span> <span class="o">=</span> <span class="n">Notification</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ident_cattle_id</span><span class="o">=</span><span class="n">d</span><span class="p">,</span> <span class="n">start_date</span><span class="o">=</span><span class="n">one_day_before</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
					<span class="n">notifi</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="mi">0</span>
					<span class="n">notifi</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">assignNotification</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
				<span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">assignNotification</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
					

		<span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;Notificación, REALIZADA con ÉXITO&#39;</span>
		<span class="n">n</span> <span class="o">=</span> <span class="n">Notification</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
		<span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">users</span><span class="p">:</span>
			<span class="k">print</span> <span class="s">&quot;enviando a: &quot;</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">username</span>
			<span class="n">ishout_client</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span>
					<span class="n">u</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
					<span class="s">&#39;notifications&#39;</span><span class="p">,</span>
					<span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;msg&#39;</span><span class="p">:</span> <span class="n">msg</span><span class="p">,</span>
							<span class="s">&#39;number_notifications&#39;</span><span class="p">:</span> <span class="n">n</span><span class="p">,}</span>
				<span class="p">)</span>

</div></div>
<div class="viewcode-block" id="AgentProduccion"><a class="viewcode-back" href="../../../webServices.wsGanados.html#webServices.wsGanados.views.AgentProduccion">[documentos]</a><span class="k">class</span> <span class="nc">AgentProduccion</span><span class="p">(</span><span class="n">spade</span><span class="o">.</span><span class="n">Agent</span><span class="o">.</span><span class="n">Agent</span><span class="p">):</span>
<div class="viewcode-block" id="AgentProduccion.BehaviourProduccion"><a class="viewcode-back" href="../../../webServices.wsGanados.html#webServices.wsGanados.views.AgentProduccion.BehaviourProduccion">[documentos]</a>	<span class="k">class</span> <span class="nc">BehaviourProduccion</span><span class="p">(</span><span class="n">spade</span><span class="o">.</span><span class="n">Behaviour</span><span class="o">.</span><span class="n">OneShotBehaviour</span><span class="p">):</span>
<div class="viewcode-block" id="AgentProduccion.BehaviourProduccion.onStart"><a class="viewcode-back" href="../../../webServices.wsGanados.html#webServices.wsGanados.views.AgentProduccion.BehaviourProduccion.onStart">[documentos]</a>		<span class="k">def</span> <span class="nf">onStart</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
			<span class="k">print</span> <span class="s">&quot;inicio del BehaviourProduccion . . .&quot;</span>
</div>
		<span class="k">def</span> <span class="nf">_process</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
			<span class="k">print</span> <span class="s">&quot;Inicio del proceso del BehaviourProduccion&quot;</span>
			<span class="n">desire</span> <span class="o">=</span> <span class="n">DesireProduccion</span><span class="p">()</span>		
			<span class="n">belief</span> <span class="o">=</span> <span class="n">BeliefProduccion</span><span class="p">()</span>
			<span class="n">intention</span> <span class="o">=</span> <span class="n">IntentionProduction</span><span class="p">()</span>
			<span class="k">if</span> <span class="mi">5</span> <span class="ow">in</span> <span class="n">belief</span><span class="o">.</span><span class="n">belief1</span><span class="p">:</span>
				<span class="n">intention</span><span class="o">.</span><span class="n">sendNotificationOrdenio</span><span class="p">(</span><span class="n">desire</span><span class="o">.</span><span class="n">desire_ordenio</span><span class="p">)</span>
				<span class="k">print</span> <span class="s">&quot;Notificación enviada&quot;</span>

<div class="viewcode-block" id="AgentProduccion.BehaviourProduccion.onEnd"><a class="viewcode-back" href="../../../webServices.wsGanados.html#webServices.wsGanados.views.AgentProduccion.BehaviourProduccion.onEnd">[documentos]</a>		<span class="k">def</span> <span class="nf">onEnd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
			<span class="k">print</span> <span class="s">&quot;fin del BehaviourProduccion . . .&quot;</span>
			<span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</div></div>
	<span class="k">def</span> <span class="nf">_setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">print</span> <span class="s">&quot;Inicio del AgentProduccion . . .&quot;</span>
		<span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">BehaviourProduccion</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">addBehaviour</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

<span class="c">################################################</span>
<span class="c"># Agente Sanidad</span>
<span class="c">################################################</span></div>
<div class="viewcode-block" id="DesireSanidad"><a class="viewcode-back" href="../../../webServices.wsGanados.html#webServices.wsGanados.views.DesireSanidad">[documentos]</a><span class="k">class</span> <span class="nc">DesireSanidad</span><span class="p">:</span>
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">desire_amount_vaccine</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">desire_amount_wormer</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">desire_expiration_vaccine</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">desire_expiration_wormer</span> <span class="o">=</span> <span class="p">[]</span>

		<span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">user_name</span><span class="p">)</span>
		<span class="n">farm</span> <span class="o">=</span> <span class="n">Ganaderia</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">perfil</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>
		<span class="n">medicament_vaccine</span> <span class="o">=</span> <span class="n">Medicament</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">farm</span><span class="o">=</span><span class="n">farm</span><span class="p">,</span> <span class="n">amount__lt</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">is_vaccine</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
		<span class="n">medicament_wormer</span> <span class="o">=</span> <span class="n">Medicament</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">farm</span><span class="o">=</span><span class="n">farm</span><span class="p">,</span> <span class="n">amount__lt</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">is_wormer</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
		<span class="n">medicament_expiration_vaccine</span> <span class="o">=</span> <span class="n">Medicament</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">farm</span><span class="o">=</span><span class="n">farm</span><span class="p">,</span> <span class="n">is_vaccine</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
		<span class="n">medicament_expiration_wormer</span> <span class="o">=</span> <span class="n">Medicament</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">farm</span><span class="o">=</span><span class="n">farm</span><span class="p">,</span> <span class="n">is_wormer</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

		<span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">medicament_vaccine</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">desire_amount_vaccine</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">medicament_wormer</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">desire_amount_wormer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
		
		<span class="n">date_expiration</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span> <span class="o">+</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">medicament_expiration_vaccine</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">expiration_date</span> <span class="o">&lt;</span> <span class="n">date_expiration</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">desire_expiration_vaccine</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">medicament_expiration_wormer</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">expiration_date</span> <span class="o">&lt;</span> <span class="n">date_expiration</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">desire_expiration_wormer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="BeliefSanidad"><a class="viewcode-back" href="../../../webServices.wsGanados.html#webServices.wsGanados.views.BeliefSanidad">[documentos]</a><span class="k">class</span> <span class="nc">BeliefSanidad</span><span class="p">:</span>
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">beliefs</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">beliefs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">beliefs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">beliefs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">beliefs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">beliefs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">beliefs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="IntentionSanidad"><a class="viewcode-back" href="../../../webServices.wsGanados.html#webServices.wsGanados.views.IntentionSanidad">[documentos]</a><span class="k">class</span> <span class="nc">IntentionSanidad</span><span class="p">:</span>
<div class="viewcode-block" id="IntentionSanidad.assignNotification"><a class="viewcode-back" href="../../../webServices.wsGanados.html#webServices.wsGanados.views.IntentionSanidad.assignNotification">[documentos]</a>	<span class="k">def</span> <span class="nf">assignNotification</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">datee</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
		<span class="n">notification</span> <span class="o">=</span> <span class="n">Notification</span><span class="p">()</span>
		<span class="n">notification</span><span class="o">.</span><span class="n">start_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>
		<span class="n">notification</span><span class="o">.</span><span class="n">end_date</span> <span class="o">=</span> <span class="n">datee</span>
		<span class="n">notification</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="mi">2</span>
		<span class="n">notification</span><span class="o">.</span><span class="n">module</span> <span class="o">=</span> <span class="mi">2</span>
		<span class="n">medicament</span> <span class="o">=</span> <span class="n">Medicament</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">d</span><span class="p">)</span>
		<span class="n">notification</span><span class="o">.</span><span class="n">ident_medicament</span> <span class="o">=</span> <span class="n">medicament</span>
		<span class="n">notification</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
		<span class="n">notification</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

		<span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">user_name</span><span class="p">)</span>
		<span class="n">farm</span> <span class="o">=</span> <span class="n">Ganaderia</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">perfil</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>
		<span class="n">users</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">profile_user__ganaderia_perfil</span><span class="o">=</span><span class="n">farm</span><span class="p">)</span>

		<span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;Notificación, REALIZADA con ÉXITO&#39;</span>
		<span class="n">n</span> <span class="o">=</span> <span class="n">Notification</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
		<span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">users</span><span class="p">:</span>
			<span class="k">print</span> <span class="s">&quot;enviando a: &quot;</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">username</span>
			<span class="n">ishout_client</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span>
					<span class="n">u</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
					<span class="s">&#39;notifications&#39;</span><span class="p">,</span>
					<span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;msg&#39;</span><span class="p">:</span> <span class="n">msg</span><span class="p">,</span>
							<span class="s">&#39;number_notifications&#39;</span><span class="p">:</span> <span class="n">n</span><span class="p">,}</span>
				<span class="p">)</span>
</div>
<div class="viewcode-block" id="IntentionSanidad.sendNotificationAmountVaccine"><a class="viewcode-back" href="../../../webServices.wsGanados.html#webServices.wsGanados.views.IntentionSanidad.sendNotificationAmountVaccine">[documentos]</a>	<span class="k">def</span> <span class="nf">sendNotificationAmountVaccine</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">desire_amount_vaccine</span><span class="p">):</span>
		<span class="n">datee</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
		<span class="n">one_day_before</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span> <span class="o">-</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
			
		<span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">desire_amount_vaccine</span><span class="p">:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">notifi</span> <span class="o">=</span> <span class="n">Notification</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ident_medicament_id</span><span class="o">=</span><span class="n">d</span><span class="p">,</span> <span class="n">start_date</span><span class="o">=</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">(),</span> <span class="n">end_date</span><span class="o">=</span><span class="n">datee</span><span class="p">)</span>
			<span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="n">notifi</span> <span class="o">=</span> <span class="n">Notification</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ident_medicament_id</span><span class="o">=</span><span class="n">d</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="n">one_day_before</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
					<span class="n">notifi</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="mi">0</span>
					<span class="n">notifi</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">assignNotification</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">datee</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
				<span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
					<span class="k">try</span><span class="p">:</span>
						<span class="n">notifi</span> <span class="o">=</span> <span class="n">Notification</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ident_medicament_id</span><span class="o">=</span><span class="n">d</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
					<span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">assignNotification</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">datee</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="IntentionSanidad.sendNotificationAmountWormer"><a class="viewcode-back" href="../../../webServices.wsGanados.html#webServices.wsGanados.views.IntentionSanidad.sendNotificationAmountWormer">[documentos]</a>	<span class="k">def</span> <span class="nf">sendNotificationAmountWormer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">desire_amount_wormer</span><span class="p">):</span>
		<span class="n">datee</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
		<span class="n">one_day_before</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span> <span class="o">-</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

		<span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">desire_amount_wormer</span><span class="p">:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">notifi</span> <span class="o">=</span> <span class="n">Notification</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ident_medicament_id</span><span class="o">=</span><span class="n">d</span><span class="p">,</span> <span class="n">start_date</span><span class="o">=</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">(),</span> <span class="n">end_date</span><span class="o">=</span><span class="n">datee</span><span class="p">)</span>
			<span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="n">notifi</span> <span class="o">=</span> <span class="n">Notification</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ident_medicament_id</span><span class="o">=</span><span class="n">d</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="n">one_day_before</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
					<span class="n">notifi</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="mi">0</span>
					<span class="n">notifi</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">assignNotification</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">datee</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
				<span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
					<span class="k">try</span><span class="p">:</span>
						<span class="n">notifi</span> <span class="o">=</span> <span class="n">Notification</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ident_medicament_id</span><span class="o">=</span><span class="n">d</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
					<span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">assignNotification</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">datee</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="IntentionSanidad.sendNotificationExpirationVaccine"><a class="viewcode-back" href="../../../webServices.wsGanados.html#webServices.wsGanados.views.IntentionSanidad.sendNotificationExpirationVaccine">[documentos]</a>	<span class="k">def</span> <span class="nf">sendNotificationExpirationVaccine</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">desire_expiration_vaccine</span><span class="p">):</span>
		<span class="n">datee</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span> <span class="o">+</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
		<span class="n">one_day_before</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span> <span class="o">-</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
		
		<span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">desire_expiration_vaccine</span><span class="p">:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">notifi</span> <span class="o">=</span> <span class="n">Notification</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ident_medicament_id</span><span class="o">=</span><span class="n">d</span><span class="p">,</span> <span class="n">start_date</span><span class="o">=</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">(),</span> <span class="n">end_date</span><span class="o">=</span><span class="n">datee</span><span class="p">)</span>
			<span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="n">notifi</span> <span class="o">=</span> <span class="n">Notification</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ident_medicament_id</span><span class="o">=</span><span class="n">d</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="n">one_day_before</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
					<span class="n">notifi</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="mi">0</span>
					<span class="n">notifi</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">assignNotification</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">datee</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
				<span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
					<span class="k">try</span><span class="p">:</span>
						<span class="n">notifi</span> <span class="o">=</span> <span class="n">Notification</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ident_medicament_id</span><span class="o">=</span><span class="n">d</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
					<span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">assignNotification</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">datee</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="IntentionSanidad.sendNotificationExpirationWormer"><a class="viewcode-back" href="../../../webServices.wsGanados.html#webServices.wsGanados.views.IntentionSanidad.sendNotificationExpirationWormer">[documentos]</a>	<span class="k">def</span> <span class="nf">sendNotificationExpirationWormer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">desire_expiration_wormer</span><span class="p">):</span>
		<span class="n">datee</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span> <span class="o">+</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
		<span class="n">one_day_before</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span> <span class="o">-</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
		
		<span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">desire_expiration_wormer</span><span class="p">:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">notifi</span> <span class="o">=</span> <span class="n">Notification</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ident_medicament_id</span><span class="o">=</span><span class="n">d</span><span class="p">,</span> <span class="n">start_date</span><span class="o">=</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">(),</span> <span class="n">end_date</span><span class="o">=</span><span class="n">datee</span><span class="p">)</span>
			<span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="n">notifi</span> <span class="o">=</span> <span class="n">Notification</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ident_medicament_id</span><span class="o">=</span><span class="n">d</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="n">one_day_before</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
					<span class="n">notifi</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="mi">0</span>
					<span class="n">notifi</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">assignNotification</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">datee</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
				<span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
					<span class="k">try</span><span class="p">:</span>
						<span class="n">notifi</span> <span class="o">=</span> <span class="n">Notification</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ident_medicament_id</span><span class="o">=</span><span class="n">d</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
					<span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">assignNotification</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">datee</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="AgentSanidad"><a class="viewcode-back" href="../../../webServices.wsGanados.html#webServices.wsGanados.views.AgentSanidad">[documentos]</a><span class="k">class</span> <span class="nc">AgentSanidad</span><span class="p">(</span><span class="n">spade</span><span class="o">.</span><span class="n">Agent</span><span class="o">.</span><span class="n">Agent</span><span class="p">):</span>
<div class="viewcode-block" id="AgentSanidad.BehaviourSanidad"><a class="viewcode-back" href="../../../webServices.wsGanados.html#webServices.wsGanados.views.AgentSanidad.BehaviourSanidad">[documentos]</a>	<span class="k">class</span> <span class="nc">BehaviourSanidad</span><span class="p">(</span><span class="n">spade</span><span class="o">.</span><span class="n">Behaviour</span><span class="o">.</span><span class="n">OneShotBehaviour</span><span class="p">):</span>
<div class="viewcode-block" id="AgentSanidad.BehaviourSanidad.onStart"><a class="viewcode-back" href="../../../webServices.wsGanados.html#webServices.wsGanados.views.AgentSanidad.BehaviourSanidad.onStart">[documentos]</a>		<span class="k">def</span> <span class="nf">onStart</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
			<span class="k">print</span> <span class="s">&quot;inicio del BehaviourSanidad . . .&quot;</span>
</div>
		<span class="k">def</span> <span class="nf">_process</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
			<span class="k">print</span> <span class="s">&quot;Inicio del proceso del BehaviourSanidad&quot;</span>
			<span class="n">desire</span> <span class="o">=</span> <span class="n">DesireSanidad</span><span class="p">()</span>		
			<span class="n">belief</span> <span class="o">=</span> <span class="n">BeliefSanidad</span><span class="p">()</span>
			<span class="n">intention</span> <span class="o">=</span> <span class="n">IntentionSanidad</span><span class="p">()</span>
			<span class="k">if</span> <span class="mi">6</span> <span class="ow">in</span> <span class="n">belief</span><span class="o">.</span><span class="n">beliefs</span><span class="p">:</span>
				<span class="n">intention</span><span class="o">.</span><span class="n">sendNotificationAmountVaccine</span><span class="p">(</span><span class="n">desire</span><span class="o">.</span><span class="n">desire_amount_vaccine</span><span class="p">)</span>
				<span class="k">print</span> <span class="s">&quot;Notificación: desire_amount_vaccine, Enviada&quot;</span>
			<span class="k">if</span> <span class="mi">7</span> <span class="ow">in</span> <span class="n">belief</span><span class="o">.</span><span class="n">beliefs</span><span class="p">:</span>
				<span class="n">intention</span><span class="o">.</span><span class="n">sendNotificationAmountWormer</span><span class="p">(</span><span class="n">desire</span><span class="o">.</span><span class="n">desire_amount_wormer</span><span class="p">)</span>
				<span class="k">print</span> <span class="s">&quot;Notificación: desire_amount_wormer, Enviada&quot;</span>
			<span class="k">if</span> <span class="mi">8</span> <span class="ow">in</span> <span class="n">belief</span><span class="o">.</span><span class="n">beliefs</span><span class="p">:</span>
				<span class="n">intention</span><span class="o">.</span><span class="n">sendNotificationExpirationVaccine</span><span class="p">(</span><span class="n">desire</span><span class="o">.</span><span class="n">desire_expiration_vaccine</span><span class="p">)</span>
				<span class="k">print</span> <span class="s">&quot;Notificación: desire_expiration_vaccine, Enviada&quot;</span>
			<span class="k">if</span> <span class="mi">9</span> <span class="ow">in</span> <span class="n">belief</span><span class="o">.</span><span class="n">beliefs</span><span class="p">:</span>
				<span class="n">intention</span><span class="o">.</span><span class="n">sendNotificationExpirationWormer</span><span class="p">(</span><span class="n">desire</span><span class="o">.</span><span class="n">desire_expiration_wormer</span><span class="p">)</span>
				<span class="k">print</span> <span class="s">&quot;Notificación: desire_expiration_wormer, Enviada&quot;</span>

<div class="viewcode-block" id="AgentSanidad.BehaviourSanidad.onEnd"><a class="viewcode-back" href="../../../webServices.wsGanados.html#webServices.wsGanados.views.AgentSanidad.BehaviourSanidad.onEnd">[documentos]</a>		<span class="k">def</span> <span class="nf">onEnd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
			<span class="k">print</span> <span class="s">&quot;fin del BehaviourSanidad . . .&quot;</span>
			<span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</div></div>
	<span class="k">def</span> <span class="nf">_setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">print</span> <span class="s">&quot;Inicio del AgentSanidad . . .&quot;</span>
		<span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">BehaviourSanidad</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">addBehaviour</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>


<span class="c">################################################</span>
<span class="c"># Agente Alimentacion</span>
<span class="c">################################################</span></div>
<div class="viewcode-block" id="DesireAlimentacion"><a class="viewcode-back" href="../../../webServices.wsGanados.html#webServices.wsGanados.views.DesireAlimentacion">[documentos]</a><span class="k">class</span> <span class="nc">DesireAlimentacion</span><span class="p">:</span>
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">desire_amount_food</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">desire_expiration_food</span> <span class="o">=</span> <span class="p">[]</span>
		

		<span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">user_name</span><span class="p">)</span>
		<span class="n">farm</span> <span class="o">=</span> <span class="n">Ganaderia</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">perfil</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>
		<span class="n">food_amount</span> <span class="o">=</span> <span class="n">Food</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">farm</span><span class="o">=</span><span class="n">farm</span><span class="p">,</span> <span class="n">amount__lt</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
		<span class="n">food_expiration</span> <span class="o">=</span> <span class="n">Food</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">farm</span><span class="o">=</span><span class="n">farm</span><span class="p">)</span>

		<span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">food_amount</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">desire_amount_food</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

		<span class="n">date_expiration</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span> <span class="o">+</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">food_expiration</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">expiration_date</span> <span class="o">&lt;</span> <span class="n">date_expiration</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">desire_expiration_food</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="BeliefAlimentacion"><a class="viewcode-back" href="../../../webServices.wsGanados.html#webServices.wsGanados.views.BeliefAlimentacion">[documentos]</a><span class="k">class</span> <span class="nc">BeliefAlimentacion</span><span class="p">:</span>
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">beliefs</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">beliefs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">beliefs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">13</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">beliefs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">14</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="IntentionAlimentacion"><a class="viewcode-back" href="../../../webServices.wsGanados.html#webServices.wsGanados.views.IntentionAlimentacion">[documentos]</a><span class="k">class</span> <span class="nc">IntentionAlimentacion</span><span class="p">:</span>
<div class="viewcode-block" id="IntentionAlimentacion.assignNotification"><a class="viewcode-back" href="../../../webServices.wsGanados.html#webServices.wsGanados.views.IntentionAlimentacion.assignNotification">[documentos]</a>	<span class="k">def</span> <span class="nf">assignNotification</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">datee</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
		<span class="n">notification</span> <span class="o">=</span> <span class="n">Notification</span><span class="p">()</span>
		<span class="n">notification</span><span class="o">.</span><span class="n">start_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>
		<span class="n">notification</span><span class="o">.</span><span class="n">end_date</span> <span class="o">=</span> <span class="n">datee</span>
		<span class="n">notification</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="mi">2</span>
		<span class="n">notification</span><span class="o">.</span><span class="n">module</span> <span class="o">=</span> <span class="mi">1</span>
		<span class="n">food</span> <span class="o">=</span> <span class="n">Food</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">d</span><span class="p">)</span>
		<span class="n">notification</span><span class="o">.</span><span class="n">ident_food</span> <span class="o">=</span> <span class="n">food</span>
		<span class="n">notification</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
		<span class="n">notification</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

		<span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">user_name</span><span class="p">)</span>
		<span class="n">farm</span> <span class="o">=</span> <span class="n">Ganaderia</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">perfil</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>
		<span class="n">users</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">profile_user__ganaderia_perfil</span><span class="o">=</span><span class="n">farm</span><span class="p">)</span>

		<span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;Notificación, REALIZADA con ÉXITO&#39;</span>
		<span class="n">n</span> <span class="o">=</span> <span class="n">Notification</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
		<span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">users</span><span class="p">:</span>
			<span class="k">print</span> <span class="s">&quot;enviando a: &quot;</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">username</span>
			<span class="n">ishout_client</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span>
					<span class="n">u</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
					<span class="s">&#39;notifications&#39;</span><span class="p">,</span>
					<span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;msg&#39;</span><span class="p">:</span> <span class="n">msg</span><span class="p">,</span>
							<span class="s">&#39;number_notifications&#39;</span><span class="p">:</span> <span class="n">n</span><span class="p">,}</span>
				<span class="p">)</span>
</div>
<div class="viewcode-block" id="IntentionAlimentacion.sendNotificationAmountFood"><a class="viewcode-back" href="../../../webServices.wsGanados.html#webServices.wsGanados.views.IntentionAlimentacion.sendNotificationAmountFood">[documentos]</a>	<span class="k">def</span> <span class="nf">sendNotificationAmountFood</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">desire_amount_food</span><span class="p">):</span>
		<span class="n">datee</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
		<span class="n">one_day_before</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span> <span class="o">-</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
		
		<span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">desire_amount_food</span><span class="p">:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">notifi</span> <span class="o">=</span> <span class="n">Notification</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ident_food_id</span><span class="o">=</span><span class="n">d</span><span class="p">,</span> <span class="n">start_date</span><span class="o">=</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">(),</span> <span class="n">end_date</span><span class="o">=</span><span class="n">datee</span><span class="p">)</span>
			<span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="n">notifi</span> <span class="o">=</span> <span class="n">Notification</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ident_food_id</span><span class="o">=</span><span class="n">d</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="n">one_day_before</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
					<span class="n">notifi</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="mi">0</span>
					<span class="n">notifi</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">assignNotification</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">datee</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
				<span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
					<span class="k">try</span><span class="p">:</span>
						<span class="n">notifi</span> <span class="o">=</span> <span class="n">Notification</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ident_food_id</span><span class="o">=</span><span class="n">d</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
					<span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">assignNotification</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">datee</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="IntentionAlimentacion.sendNotificationExpirationFood"><a class="viewcode-back" href="../../../webServices.wsGanados.html#webServices.wsGanados.views.IntentionAlimentacion.sendNotificationExpirationFood">[documentos]</a>	<span class="k">def</span> <span class="nf">sendNotificationExpirationFood</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">desire_expiration_food</span><span class="p">):</span>
		<span class="n">datee</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span> <span class="o">+</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
		<span class="n">one_day_before</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span> <span class="o">-</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
		
		<span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">desire_expiration_food</span><span class="p">:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">notifi</span> <span class="o">=</span> <span class="n">Notification</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ident_food_id</span><span class="o">=</span><span class="n">d</span><span class="p">,</span> <span class="n">start_date</span><span class="o">=</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">(),</span> <span class="n">end_date</span><span class="o">=</span><span class="n">datee</span><span class="p">)</span>
			<span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="n">notifi</span> <span class="o">=</span> <span class="n">Notification</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ident_food_id</span><span class="o">=</span><span class="n">d</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="n">one_day_before</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
					<span class="n">notifi</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="mi">0</span>
					<span class="n">notifi</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">assignNotification</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">datee</span><span class="p">,</span> <span class="mi">13</span><span class="p">)</span>
				<span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
					<span class="k">try</span><span class="p">:</span>
						<span class="n">notifi</span> <span class="o">=</span> <span class="n">Notification</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ident_food_id</span><span class="o">=</span><span class="n">d</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
					<span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">assignNotification</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">datee</span><span class="p">,</span> <span class="mi">13</span><span class="p">)</span>
				

</div></div>
<div class="viewcode-block" id="AgentAlimentacion"><a class="viewcode-back" href="../../../webServices.wsGanados.html#webServices.wsGanados.views.AgentAlimentacion">[documentos]</a><span class="k">class</span> <span class="nc">AgentAlimentacion</span><span class="p">(</span><span class="n">spade</span><span class="o">.</span><span class="n">Agent</span><span class="o">.</span><span class="n">Agent</span><span class="p">):</span>
<div class="viewcode-block" id="AgentAlimentacion.BehaviourAlimentacion"><a class="viewcode-back" href="../../../webServices.wsGanados.html#webServices.wsGanados.views.AgentAlimentacion.BehaviourAlimentacion">[documentos]</a>	<span class="k">class</span> <span class="nc">BehaviourAlimentacion</span><span class="p">(</span><span class="n">spade</span><span class="o">.</span><span class="n">Behaviour</span><span class="o">.</span><span class="n">OneShotBehaviour</span><span class="p">):</span>
<div class="viewcode-block" id="AgentAlimentacion.BehaviourAlimentacion.onStart"><a class="viewcode-back" href="../../../webServices.wsGanados.html#webServices.wsGanados.views.AgentAlimentacion.BehaviourAlimentacion.onStart">[documentos]</a>		<span class="k">def</span> <span class="nf">onStart</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
			<span class="k">print</span> <span class="s">&quot;inicio del BehaviourAlimentacion . . .&quot;</span>
</div>
		<span class="k">def</span> <span class="nf">_process</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
			<span class="k">print</span> <span class="s">&quot;Inicio del proceso del BehaviourAlimentacion&quot;</span>
			<span class="n">desire</span> <span class="o">=</span> <span class="n">DesireAlimentacion</span><span class="p">()</span>		
			<span class="n">belief</span> <span class="o">=</span> <span class="n">BeliefAlimentacion</span><span class="p">()</span>
			<span class="n">intention</span> <span class="o">=</span> <span class="n">IntentionAlimentacion</span><span class="p">()</span>
			<span class="k">if</span> <span class="mi">12</span> <span class="ow">in</span> <span class="n">belief</span><span class="o">.</span><span class="n">beliefs</span><span class="p">:</span>
				<span class="n">intention</span><span class="o">.</span><span class="n">sendNotificationAmountFood</span><span class="p">(</span><span class="n">desire</span><span class="o">.</span><span class="n">desire_amount_food</span><span class="p">)</span>
				<span class="k">print</span> <span class="s">&quot;Notificación: desire_amount_food, Enviada&quot;</span>
			<span class="k">if</span> <span class="mi">13</span> <span class="ow">in</span> <span class="n">belief</span><span class="o">.</span><span class="n">beliefs</span><span class="p">:</span>
				<span class="n">intention</span><span class="o">.</span><span class="n">sendNotificationExpirationFood</span><span class="p">(</span><span class="n">desire</span><span class="o">.</span><span class="n">desire_expiration_food</span><span class="p">)</span>
				<span class="k">print</span> <span class="s">&quot;Notificación: desire_expiration_food, Enviada&quot;</span>

<div class="viewcode-block" id="AgentAlimentacion.BehaviourAlimentacion.onEnd"><a class="viewcode-back" href="../../../webServices.wsGanados.html#webServices.wsGanados.views.AgentAlimentacion.BehaviourAlimentacion.onEnd">[documentos]</a>		<span class="k">def</span> <span class="nf">onEnd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
			<span class="k">print</span> <span class="s">&quot;fin del BehaviourAlimentacion . . .&quot;</span>
			<span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</div></div>
	<span class="k">def</span> <span class="nf">_setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">print</span> <span class="s">&quot;Inicio del AgentAlimentacion . . .&quot;</span>
		<span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">BehaviourAlimentacion</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">addBehaviour</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>



<span class="c">################################################</span>
<span class="c"># Agente Reproduccion</span>
<span class="c">################################################</span></div>
<div class="viewcode-block" id="DesireReproduccion"><a class="viewcode-back" href="../../../webServices.wsGanados.html#webServices.wsGanados.views.DesireReproduccion">[documentos]</a><span class="k">class</span> <span class="nc">DesireReproduccion</span><span class="p">:</span>
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">desire_celo</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">desire_service</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">desire_verification</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">desire_parto</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">desire_pajuelas</span> <span class="o">=</span> <span class="p">[]</span>

		<span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">user_name</span><span class="p">)</span>
		<span class="n">farm</span> <span class="o">=</span> <span class="n">Ganaderia</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">perfil</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>

		<span class="k">try</span><span class="p">:</span>
			<span class="n">cattle_celo</span> <span class="o">=</span> <span class="n">Ganado</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span> <span class="n">etapas__nombre</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ganaderia</span><span class="o">=</span><span class="n">farm</span> <span class="p">)</span>
			<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cattle_celo</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">desire_celo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
		<span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
			<span class="k">pass</span>

		<span class="k">try</span><span class="p">:</span>
			<span class="n">cattle_service</span> <span class="o">=</span> <span class="n">Ganado</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span> <span class="n">ganaderia</span><span class="o">=</span><span class="n">farm</span><span class="p">,</span> <span class="n">genero</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">celos__estado</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">celos__is_active</span><span class="o">=</span><span class="bp">True</span> <span class="p">)</span>
			<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cattle_service</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">desire_service</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
		<span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
			<span class="k">pass</span>

		<span class="k">try</span><span class="p">:</span>
			<span class="n">cattle_verification</span> <span class="o">=</span> <span class="n">Ganado</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span> <span class="n">ganaderia</span><span class="o">=</span><span class="n">farm</span><span class="p">,</span> <span class="n">genero</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">verification_cattle__is_active</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">verification_cattle__attempt_verification__attempt_date</span><span class="o">=</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span> <span class="p">)</span>
			<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cattle_verification</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">desire_verification</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
		<span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
			<span class="k">pass</span>

		<span class="n">ten_days_parto</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span> <span class="o">+</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">cattle_parto</span> <span class="o">=</span> <span class="n">Ganado</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span> <span class="n">ganaderia</span><span class="o">=</span><span class="n">farm</span><span class="p">,</span> <span class="n">genero</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">gestaciones__fecha_parto</span><span class="o">=</span><span class="n">ten_days_parto</span><span class="p">,</span> <span class="n">gestaciones__is_active</span><span class="o">=</span><span class="bp">True</span> <span class="p">)</span>
			<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cattle_parto</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">desire_parto</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
		<span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
			<span class="k">pass</span>

		<span class="k">try</span><span class="p">:</span>
			<span class="n">pajuelas</span> <span class="o">=</span> <span class="n">Insemination</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span> <span class="n">farm</span><span class="o">=</span><span class="n">farm</span><span class="p">,</span> <span class="n">amount_pajuelas__lt</span><span class="o">=</span><span class="mi">5</span> <span class="p">)</span>
			<span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pajuelas</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">desire_pajuelas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
		<span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
			<span class="k">pass</span>


</div>
<div class="viewcode-block" id="BeliefReproduccion"><a class="viewcode-back" href="../../../webServices.wsGanados.html#webServices.wsGanados.views.BeliefReproduccion">[documentos]</a><span class="k">class</span> <span class="nc">BeliefReproduccion</span><span class="p">:</span>
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">beliefs</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">beliefs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">beliefs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">beliefs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">beliefs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">beliefs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="IntentionReproduccion"><a class="viewcode-back" href="../../../webServices.wsGanados.html#webServices.wsGanados.views.IntentionReproduccion">[documentos]</a><span class="k">class</span> <span class="nc">IntentionReproduccion</span><span class="p">:</span>
<div class="viewcode-block" id="IntentionReproduccion.assignNotification"><a class="viewcode-back" href="../../../webServices.wsGanados.html#webServices.wsGanados.views.IntentionReproduccion.assignNotification">[documentos]</a>	<span class="k">def</span> <span class="nf">assignNotification</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">datee</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
		<span class="n">notification</span> <span class="o">=</span> <span class="n">Notification</span><span class="p">()</span>
		<span class="n">notification</span><span class="o">.</span><span class="n">start_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>
		<span class="n">notification</span><span class="o">.</span><span class="n">end_date</span> <span class="o">=</span> <span class="n">datee</span>
		<span class="n">notification</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="mi">2</span>
		<span class="n">notification</span><span class="o">.</span><span class="n">module</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="n">cattle</span> <span class="o">=</span> <span class="n">Ganado</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">d</span><span class="p">)</span>
		<span class="n">notification</span><span class="o">.</span><span class="n">ident_cattle</span> <span class="o">=</span> <span class="n">cattle</span>
		<span class="n">notification</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
		<span class="n">notification</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

		<span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">user_name</span><span class="p">)</span>
		<span class="n">farm</span> <span class="o">=</span> <span class="n">Ganaderia</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">perfil</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>
		<span class="n">users</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">profile_user__ganaderia_perfil</span><span class="o">=</span><span class="n">farm</span><span class="p">)</span>

		<span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;Notificación, REALIZADA con ÉXITO&#39;</span>
		<span class="n">n</span> <span class="o">=</span> <span class="n">Notification</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
		<span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">users</span><span class="p">:</span>
			<span class="k">print</span> <span class="s">&quot;enviando a: &quot;</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">username</span>
			<span class="n">ishout_client</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span>
					<span class="n">u</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
					<span class="s">&#39;notifications&#39;</span><span class="p">,</span>
					<span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;msg&#39;</span><span class="p">:</span> <span class="n">msg</span><span class="p">,</span>
							<span class="s">&#39;number_notifications&#39;</span><span class="p">:</span> <span class="n">n</span><span class="p">,}</span>
				<span class="p">)</span>
</div>
<div class="viewcode-block" id="IntentionReproduccion.sendNotificationCelo"><a class="viewcode-back" href="../../../webServices.wsGanados.html#webServices.wsGanados.views.IntentionReproduccion.sendNotificationCelo">[documentos]</a>	<span class="k">def</span> <span class="nf">sendNotificationCelo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">desire_celo</span><span class="p">):</span>
		<span class="n">datee</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
		<span class="n">one_day_before</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span> <span class="o">-</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
		<span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">user_name</span><span class="p">)</span>
		<span class="n">farm</span> <span class="o">=</span> <span class="n">Ganaderia</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">perfil</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>
		<span class="n">configuration</span> <span class="o">=</span> <span class="n">Configuracion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">farm</span><span class="o">.</span><span class="n">configuracion_id</span><span class="p">)</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">cattles</span> <span class="o">=</span> <span class="n">Ganado</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">ganaderia</span><span class="o">=</span><span class="n">farm</span><span class="p">,</span> <span class="n">etapas__nombre</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ciclos__nombre</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ciclos__is_active</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

			<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cattles</span><span class="p">:</span>

				<span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">gestaciones</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
					<span class="k">for</span> <span class="n">c_parto</span> <span class="ow">in</span> <span class="n">c</span><span class="o">.</span><span class="n">gestaciones</span><span class="o">.</span><span class="n">all</span><span class="p">():</span> <span class="c"># itera las gestaciones que haya tenido</span>
						<span class="k">if</span> <span class="n">c_parto</span><span class="o">.</span><span class="n">is_active</span><span class="o">==</span><span class="bp">False</span><span class="p">:</span>
							<span class="n">date_parto</span> <span class="o">=</span> <span class="n">c_parto</span><span class="o">.</span><span class="n">fecha_parto</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="n">date_parto</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
				
				<span class="k">if</span> <span class="n">date_parto</span> <span class="o">!=</span> <span class="s">&#39;&#39;</span><span class="p">:</span>  <span class="c"># si existe una previa gestacion (!=)</span>
					<span class="n">days_after_parto</span> <span class="o">=</span> <span class="n">configuration</span><span class="o">.</span><span class="n">celo_despues_parto</span>
					<span class="n">days_after_parto_error</span> <span class="o">=</span> <span class="n">configuration</span><span class="o">.</span><span class="n">celo_despues_parto_error</span>
					<span class="n">date_celo</span> <span class="o">=</span> <span class="n">date_parto</span> <span class="o">+</span> <span class="n">relativedelta</span><span class="p">(</span> <span class="n">days</span><span class="o">=</span><span class="p">(</span><span class="n">days_after_parto</span> <span class="o">+</span> <span class="n">days_after_parto_error</span><span class="p">)</span> <span class="p">)</span>
					
					<span class="k">if</span> <span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">date_celo</span><span class="p">:</span> <span class="c"># si &gt;= a la fecha de celo luego del parto</span>
						<span class="n">celo</span> <span class="o">=</span> <span class="n">Celo</span><span class="p">()</span>
						<span class="n">start_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">pytz</span><span class="o">.</span><span class="n">timezone</span><span class="p">(</span><span class="s">&#39;America/Guayaquil&#39;</span><span class="p">))</span>
						<span class="n">duration_celo</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="n">configuration</span><span class="o">.</span><span class="n">celo_duracion</span> <span class="o">+</span> <span class="n">configuration</span><span class="o">.</span><span class="n">celo_duracion_error</span><span class="p">)</span>
						<span class="n">end_date</span> <span class="o">=</span> <span class="n">start_date</span> <span class="o">+</span> <span class="n">duration_celo</span>
						<span class="n">celo</span><span class="o">.</span><span class="n">fecha_inicio</span> <span class="o">=</span> <span class="n">start_date</span>
						<span class="n">celo</span><span class="o">.</span><span class="n">fecha_fin</span> <span class="o">=</span> <span class="n">end_date</span>
						<span class="n">celo</span><span class="o">.</span><span class="n">estado</span> <span class="o">=</span> <span class="mi">0</span>
						<span class="n">celo</span><span class="o">.</span><span class="n">observaciones</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
						<span class="n">celo</span><span class="o">.</span><span class="n">ganado</span> <span class="o">=</span> <span class="n">c</span>
						<span class="n">celo</span><span class="o">.</span><span class="n">is_active</span> <span class="o">=</span> <span class="bp">True</span>
						<span class="n">celo</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">assignNotification</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">end_date</span><span class="o">.</span><span class="n">date</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>
				<span class="k">else</span><span class="p">:</span> <span class="c"># auscencia de previa gestacion</span>
					<span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">ciclos</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
						<span class="k">for</span> <span class="n">ci</span> <span class="ow">in</span> <span class="n">c</span><span class="o">.</span><span class="n">ciclos</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
							<span class="k">if</span> <span class="n">ci</span><span class="o">.</span><span class="n">nombre</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">ci</span><span class="o">.</span><span class="n">is_active</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
								<span class="n">start_date_ciclo</span> <span class="o">=</span> <span class="n">ci</span><span class="o">.</span><span class="n">fecha_inicio</span>
								
					<span class="n">days_frequency_celo</span> <span class="o">=</span> <span class="n">configuration</span><span class="o">.</span><span class="n">celo_frecuencia</span>
					<span class="n">days_frequency_celo_error</span> <span class="o">=</span> <span class="n">configuration</span><span class="o">.</span><span class="n">celo_frecuencia_error</span>
					<span class="n">end_days</span> <span class="o">=</span> <span class="n">days_frequency_celo</span> <span class="o">-</span> <span class="n">days_frequency_celo_error</span>
					<span class="n">date_now</span> <span class="o">=</span> <span class="n">start_date_ciclo</span> <span class="o">+</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">end_days</span><span class="p">)</span>
					
					<span class="k">print</span> <span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">(),</span> <span class="s">&quot; &gt;= &quot;</span><span class="p">,</span> <span class="n">date_now</span>
					<span class="k">if</span> <span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">date_now</span><span class="p">:</span>
						<span class="n">start_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">pytz</span><span class="o">.</span><span class="n">timezone</span><span class="p">(</span><span class="s">&#39;America/Guayaquil&#39;</span><span class="p">))</span>
						<span class="n">duration_celo</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="n">configuration</span><span class="o">.</span><span class="n">celo_duracion</span> <span class="o">+</span> <span class="n">configuration</span><span class="o">.</span><span class="n">celo_duracion_error</span><span class="p">)</span>
						<span class="n">end_date</span> <span class="o">=</span> <span class="n">start_date</span> <span class="o">+</span> <span class="n">duration_celo</span>

						<span class="k">try</span><span class="p">:</span>
							<span class="n">notifi</span> <span class="o">=</span> <span class="n">Notification</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ident_cattle_id</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">start_date</span><span class="o">=</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">(),</span> <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span> <span class="n">module</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
						<span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
							<span class="k">try</span><span class="p">:</span>
								<span class="n">notifi</span> <span class="o">=</span> <span class="n">Notification</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ident_cattle_id</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="n">one_day_before</span><span class="p">,</span> <span class="n">module</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
								<span class="n">notifi</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="mi">0</span>
								<span class="n">notifi</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
								<span class="bp">self</span><span class="o">.</span><span class="n">assignNotification</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">end_date</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
							<span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
								<span class="k">try</span><span class="p">:</span>
									<span class="n">notifi</span> <span class="o">=</span> <span class="n">Notification</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ident_cattle_id</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">module</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
								<span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
									<span class="n">celo</span> <span class="o">=</span> <span class="n">Celo</span><span class="p">()</span>
									<span class="n">celo</span><span class="o">.</span><span class="n">fecha_inicio</span> <span class="o">=</span> <span class="n">start_date</span>
									<span class="n">celo</span><span class="o">.</span><span class="n">fecha_fin</span> <span class="o">=</span> <span class="n">end_date</span>
									<span class="n">celo</span><span class="o">.</span><span class="n">estado</span> <span class="o">=</span> <span class="mi">0</span>
									<span class="n">celo</span><span class="o">.</span><span class="n">observaciones</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
									<span class="n">celo</span><span class="o">.</span><span class="n">ganado</span> <span class="o">=</span> <span class="n">c</span>
									<span class="n">celo</span><span class="o">.</span><span class="n">is_active</span> <span class="o">=</span> <span class="bp">True</span>
									<span class="n">celo</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
									<span class="bp">self</span><span class="o">.</span><span class="n">assignNotification</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">end_date</span><span class="o">.</span><span class="n">date</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>

			<span class="n">users</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">profile_user__ganaderia_perfil</span><span class="o">=</span><span class="n">farm</span><span class="p">)</span>

			<span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;Notificación, REALIZADA con ÉXITO&#39;</span>
			<span class="n">n</span> <span class="o">=</span> <span class="n">Notification</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
			<span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">users</span><span class="p">:</span>
				<span class="k">print</span> <span class="s">&quot;enviando a: &quot;</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">username</span>
				<span class="n">ishout_client</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span>
						<span class="n">u</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
						<span class="s">&#39;notifications&#39;</span><span class="p">,</span>
						<span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;msg&#39;</span><span class="p">:</span> <span class="n">msg</span><span class="p">,</span>
								<span class="s">&#39;number_notifications&#39;</span><span class="p">:</span> <span class="n">n</span><span class="p">,}</span>
					<span class="p">)</span>
					
		<span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
			<span class="k">pass</span>
</div>
<div class="viewcode-block" id="IntentionReproduccion.sendNotificationService"><a class="viewcode-back" href="../../../webServices.wsGanados.html#webServices.wsGanados.views.IntentionReproduccion.sendNotificationService">[documentos]</a>	<span class="k">def</span> <span class="nf">sendNotificationService</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">desire_service</span><span class="p">):</span>
		<span class="n">datee</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
		<span class="n">one_day_before</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span> <span class="o">-</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
		<span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">user_name</span><span class="p">)</span>
		<span class="n">farm</span> <span class="o">=</span> <span class="n">Ganaderia</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">perfil</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>
		
		<span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">desire_service</span><span class="p">:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">notifi</span> <span class="o">=</span> <span class="n">Notification</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ident_cattle_id</span><span class="o">=</span><span class="n">d</span><span class="p">,</span> <span class="n">start_date</span><span class="o">=</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">(),</span> <span class="n">end_date</span><span class="o">=</span><span class="n">datee</span><span class="p">,</span> <span class="n">module</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
			<span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="n">notifi</span> <span class="o">=</span> <span class="n">Notification</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ident_cattle_id</span><span class="o">=</span><span class="n">d</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="n">one_day_before</span><span class="p">,</span> <span class="n">module</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
					<span class="n">notifi</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="mi">0</span>
					<span class="n">notifi</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">assignNotification</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">datee</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
				<span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
					<span class="k">try</span><span class="p">:</span>
						<span class="n">notifi</span> <span class="o">=</span> <span class="n">Notification</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ident_cattle_id</span><span class="o">=</span><span class="n">d</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">module</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
					<span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">assignNotification</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">datee</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
						
		<span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">user_name</span><span class="p">)</span>
		<span class="n">farm</span> <span class="o">=</span> <span class="n">Ganaderia</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">perfil</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>
		<span class="n">users</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">profile_user__ganaderia_perfil</span><span class="o">=</span><span class="n">farm</span><span class="p">)</span>

		<span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;Notificación, REALIZADA con ÉXITO&#39;</span>
		<span class="n">n</span> <span class="o">=</span> <span class="n">Notification</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
		<span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">users</span><span class="p">:</span>
			<span class="k">print</span> <span class="s">&quot;enviando a: &quot;</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">username</span>
			<span class="n">ishout_client</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span>
					<span class="n">u</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
					<span class="s">&#39;notifications&#39;</span><span class="p">,</span>
					<span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;msg&#39;</span><span class="p">:</span> <span class="n">msg</span><span class="p">,</span>
							<span class="s">&#39;number_notifications&#39;</span><span class="p">:</span> <span class="n">n</span><span class="p">,}</span>
				<span class="p">)</span>
</div>
<div class="viewcode-block" id="IntentionReproduccion.sendNotificationVerification"><a class="viewcode-back" href="../../../webServices.wsGanados.html#webServices.wsGanados.views.IntentionReproduccion.sendNotificationVerification">[documentos]</a>	<span class="k">def</span> <span class="nf">sendNotificationVerification</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">desire_verification</span><span class="p">):</span>
		<span class="n">datee</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
		<span class="n">one_day_before</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span> <span class="o">-</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
		<span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">user_name</span><span class="p">)</span>
		<span class="n">farm</span> <span class="o">=</span> <span class="n">Ganaderia</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">perfil</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>
		<span class="n">configuration</span> <span class="o">=</span> <span class="n">Configuracion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">farm</span><span class="o">.</span><span class="n">configuracion_id</span><span class="p">)</span>

		<span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">desire_verification</span><span class="p">:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">notifi</span> <span class="o">=</span> <span class="n">Notification</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ident_cattle_id</span><span class="o">=</span><span class="n">d</span><span class="p">,</span> <span class="n">start_date</span><span class="o">=</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">(),</span> <span class="n">end_date</span><span class="o">=</span><span class="n">datee</span><span class="p">,</span> <span class="n">module</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="mi">2</span> <span class="p">)</span>
			<span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="n">notifi</span> <span class="o">=</span> <span class="n">Notification</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ident_cattle_id</span><span class="o">=</span><span class="n">d</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="n">one_day_before</span><span class="p">,</span> <span class="n">module</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
					<span class="n">notifi</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="mi">0</span>
					<span class="n">notifi</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">assignNotification</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">datee</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
				<span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
					<span class="k">try</span><span class="p">:</span>
						<span class="n">notifi</span> <span class="o">=</span> <span class="n">Notification</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ident_cattle_id</span><span class="o">=</span><span class="n">d</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">module</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
					<span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">assignNotification</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">datee</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
						
		<span class="n">users</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">profile_user__ganaderia_perfil</span><span class="o">=</span><span class="n">farm</span><span class="p">)</span>

		<span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;Notificación, REALIZADA con ÉXITO&#39;</span>
		<span class="n">n</span> <span class="o">=</span> <span class="n">Notification</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
		<span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">users</span><span class="p">:</span>
			<span class="k">print</span> <span class="s">&quot;enviando a: &quot;</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">username</span>
			<span class="n">ishout_client</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span>
					<span class="n">u</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
					<span class="s">&#39;notifications&#39;</span><span class="p">,</span>
					<span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;msg&#39;</span><span class="p">:</span> <span class="n">msg</span><span class="p">,</span>
							<span class="s">&#39;number_notifications&#39;</span><span class="p">:</span> <span class="n">n</span><span class="p">,}</span>
				<span class="p">)</span>
</div>
<div class="viewcode-block" id="IntentionReproduccion.sendNotificationParto"><a class="viewcode-back" href="../../../webServices.wsGanados.html#webServices.wsGanados.views.IntentionReproduccion.sendNotificationParto">[documentos]</a>	<span class="k">def</span> <span class="nf">sendNotificationParto</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">desire_parto</span><span class="p">):</span>
		<span class="n">datee</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
		<span class="n">one_day_before</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span> <span class="o">-</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
		<span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">user_name</span><span class="p">)</span>
		<span class="n">farm</span> <span class="o">=</span> <span class="n">Ganaderia</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">perfil</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>
		<span class="n">configuration</span> <span class="o">=</span> <span class="n">Configuracion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">farm</span><span class="o">.</span><span class="n">configuracion_id</span><span class="p">)</span>

		<span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">desire_parto</span><span class="p">:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">notifi</span> <span class="o">=</span> <span class="n">Notification</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ident_cattle_id</span><span class="o">=</span><span class="n">d</span><span class="p">,</span> <span class="n">start_date</span><span class="o">=</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">(),</span> <span class="n">end_date</span><span class="o">=</span><span class="n">datee</span><span class="p">,</span> <span class="n">module</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="mi">3</span> <span class="p">)</span>
			<span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="n">notifi</span> <span class="o">=</span> <span class="n">Notification</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ident_cattle_id</span><span class="o">=</span><span class="n">d</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="n">one_day_before</span><span class="p">,</span> <span class="n">module</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
					<span class="n">notifi</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="mi">0</span>
					<span class="n">notifi</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">assignNotification</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">datee</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
				<span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
					<span class="k">try</span><span class="p">:</span>
						<span class="n">notifi</span> <span class="o">=</span> <span class="n">Notification</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ident_cattle_id</span><span class="o">=</span><span class="n">d</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">module</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
					<span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">assignNotification</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">datee</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
						
		<span class="n">users</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">profile_user__ganaderia_perfil</span><span class="o">=</span><span class="n">farm</span><span class="p">)</span>

		<span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;Notificación, REALIZADA con ÉXITO&#39;</span>
		<span class="n">n</span> <span class="o">=</span> <span class="n">Notification</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
		<span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">users</span><span class="p">:</span>
			<span class="k">print</span> <span class="s">&quot;enviando a: &quot;</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">username</span>
			<span class="n">ishout_client</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span>
					<span class="n">u</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
					<span class="s">&#39;notifications&#39;</span><span class="p">,</span>
					<span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;msg&#39;</span><span class="p">:</span> <span class="n">msg</span><span class="p">,</span>
							<span class="s">&#39;number_notifications&#39;</span><span class="p">:</span> <span class="n">n</span><span class="p">,}</span>
				<span class="p">)</span>

</div>
<div class="viewcode-block" id="IntentionReproduccion.sendNotificationPajuela"><a class="viewcode-back" href="../../../webServices.wsGanados.html#webServices.wsGanados.views.IntentionReproduccion.sendNotificationPajuela">[documentos]</a>	<span class="k">def</span> <span class="nf">sendNotificationPajuela</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">desire_pajuelas</span><span class="p">):</span>
		<span class="n">datee</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
		<span class="n">one_day_before</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span> <span class="o">-</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
		<span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">user_name</span><span class="p">)</span>
		<span class="n">farm</span> <span class="o">=</span> <span class="n">Ganaderia</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">perfil</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>
		<span class="n">configuration</span> <span class="o">=</span> <span class="n">Configuracion</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">farm</span><span class="o">.</span><span class="n">configuracion_id</span><span class="p">)</span>

		<span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">desire_pajuelas</span><span class="p">:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">notifi</span> <span class="o">=</span> <span class="n">Notification</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ident_cattle_id</span><span class="o">=</span><span class="n">d</span><span class="p">,</span> <span class="n">start_date</span><span class="o">=</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">(),</span> <span class="n">end_date</span><span class="o">=</span><span class="n">datee</span><span class="p">,</span> <span class="n">module</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="mi">4</span> <span class="p">)</span>
			<span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="n">notifi</span> <span class="o">=</span> <span class="n">Notification</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ident_cattle_id</span><span class="o">=</span><span class="n">d</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="n">one_day_before</span><span class="p">,</span> <span class="n">module</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
					<span class="n">notifi</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="mi">0</span>
					<span class="n">notifi</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">assignNotification</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">datee</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
				<span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
					<span class="k">try</span><span class="p">:</span>
						<span class="n">notifi</span> <span class="o">=</span> <span class="n">Notification</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ident_cattle_id</span><span class="o">=</span><span class="n">d</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">module</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
					<span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">assignNotification</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">datee</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
						
		<span class="n">users</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">profile_user__ganaderia_perfil</span><span class="o">=</span><span class="n">farm</span><span class="p">)</span>

		<span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;Notificación, REALIZADA con ÉXITO&#39;</span>
		<span class="n">n</span> <span class="o">=</span> <span class="n">Notification</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
		<span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">users</span><span class="p">:</span>
			<span class="k">print</span> <span class="s">&quot;enviando a: &quot;</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">username</span>
			<span class="n">ishout_client</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span>
					<span class="n">u</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
					<span class="s">&#39;notifications&#39;</span><span class="p">,</span>
					<span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;msg&#39;</span><span class="p">:</span> <span class="n">msg</span><span class="p">,</span>
							<span class="s">&#39;number_notifications&#39;</span><span class="p">:</span> <span class="n">n</span><span class="p">,}</span>
				<span class="p">)</span>				


</div></div>
<div class="viewcode-block" id="AgentReproduccion"><a class="viewcode-back" href="../../../webServices.wsGanados.html#webServices.wsGanados.views.AgentReproduccion">[documentos]</a><span class="k">class</span> <span class="nc">AgentReproduccion</span><span class="p">(</span><span class="n">spade</span><span class="o">.</span><span class="n">Agent</span><span class="o">.</span><span class="n">Agent</span><span class="p">):</span>
<div class="viewcode-block" id="AgentReproduccion.BehaviourReproduccion"><a class="viewcode-back" href="../../../webServices.wsGanados.html#webServices.wsGanados.views.AgentReproduccion.BehaviourReproduccion">[documentos]</a>	<span class="k">class</span> <span class="nc">BehaviourReproduccion</span><span class="p">(</span><span class="n">spade</span><span class="o">.</span><span class="n">Behaviour</span><span class="o">.</span><span class="n">OneShotBehaviour</span><span class="p">):</span>
<div class="viewcode-block" id="AgentReproduccion.BehaviourReproduccion.onStart"><a class="viewcode-back" href="../../../webServices.wsGanados.html#webServices.wsGanados.views.AgentReproduccion.BehaviourReproduccion.onStart">[documentos]</a>		<span class="k">def</span> <span class="nf">onStart</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
			<span class="k">print</span> <span class="s">&quot;inicio del BehaviourReproduccion . . .&quot;</span>
</div>
		<span class="k">def</span> <span class="nf">_process</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
			<span class="k">print</span> <span class="s">&quot;Inicio del proceso del BehaviourReproduccion&quot;</span>
			<span class="n">desire</span> <span class="o">=</span> <span class="n">DesireReproduccion</span><span class="p">()</span>		
			<span class="n">belief</span> <span class="o">=</span> <span class="n">BeliefReproduccion</span><span class="p">()</span>
			<span class="n">intention</span> <span class="o">=</span> <span class="n">IntentionReproduccion</span><span class="p">()</span>
			
			<span class="k">if</span> <span class="mi">0</span> <span class="ow">in</span> <span class="n">belief</span><span class="o">.</span><span class="n">beliefs</span><span class="p">:</span>
				<span class="n">intention</span><span class="o">.</span><span class="n">sendNotificationCelo</span><span class="p">(</span><span class="n">desire</span><span class="o">.</span><span class="n">desire_celo</span><span class="p">)</span>
				<span class="k">print</span> <span class="s">&quot;Notificación: desire_celo, Enviada&quot;</span>
			<span class="k">if</span> <span class="mi">1</span> <span class="ow">in</span> <span class="n">belief</span><span class="o">.</span><span class="n">beliefs</span><span class="p">:</span>
				<span class="n">intention</span><span class="o">.</span><span class="n">sendNotificationService</span><span class="p">(</span><span class="n">desire</span><span class="o">.</span><span class="n">desire_service</span><span class="p">)</span>
				<span class="k">print</span> <span class="s">&quot;Notificación: desire_service, Enviada&quot;</span>
			<span class="k">if</span> <span class="mi">2</span> <span class="ow">in</span> <span class="n">belief</span><span class="o">.</span><span class="n">beliefs</span><span class="p">:</span>
				<span class="n">intention</span><span class="o">.</span><span class="n">sendNotificationVerification</span><span class="p">(</span><span class="n">desire</span><span class="o">.</span><span class="n">desire_verification</span><span class="p">)</span>
				<span class="k">print</span> <span class="s">&quot;Notificación: desire_verification, Enviada&quot;</span>
			<span class="k">if</span> <span class="mi">3</span> <span class="ow">in</span> <span class="n">belief</span><span class="o">.</span><span class="n">beliefs</span><span class="p">:</span>
				<span class="n">intention</span><span class="o">.</span><span class="n">sendNotificationParto</span><span class="p">(</span><span class="n">desire</span><span class="o">.</span><span class="n">desire_parto</span><span class="p">)</span>
				<span class="k">print</span> <span class="s">&quot;Notificación: desire_parto, Enviada&quot;</span>
			<span class="k">if</span> <span class="mi">4</span> <span class="ow">in</span> <span class="n">belief</span><span class="o">.</span><span class="n">beliefs</span><span class="p">:</span>
				<span class="n">intention</span><span class="o">.</span><span class="n">sendNotificationPajuela</span><span class="p">(</span><span class="n">desire</span><span class="o">.</span><span class="n">desire_pajuelas</span><span class="p">)</span>
				<span class="k">print</span> <span class="s">&quot;Notificación: desire_pajuelas, Enviada&quot;</span>
			
<div class="viewcode-block" id="AgentReproduccion.BehaviourReproduccion.onEnd"><a class="viewcode-back" href="../../../webServices.wsGanados.html#webServices.wsGanados.views.AgentReproduccion.BehaviourReproduccion.onEnd">[documentos]</a>		<span class="k">def</span> <span class="nf">onEnd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
			<span class="k">print</span> <span class="s">&quot;fin del BehaviourReproduccion . . .&quot;</span>
			<span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</div></div>
	<span class="k">def</span> <span class="nf">_setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">print</span> <span class="s">&quot;Inicio del AgentReproduccion . . .&quot;</span>
		<span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">BehaviourReproduccion</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">addBehaviour</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

</div>
<span class="nd">@login_required</span>
<div class="viewcode-block" id="ajaxRefresh"><a class="viewcode-back" href="../../../webServices.wsGanados.html#webServices.wsGanados.views.ajaxRefresh">[documentos]</a><span class="k">def</span> <span class="nf">ajaxRefresh</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
	<span class="n">user</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
	<span class="k">global</span> <span class="n">user_name</span>
	<span class="n">user_name</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">id</span>

	<span class="n">p</span> <span class="o">=</span> <span class="n">AgentProduccion</span><span class="p">(</span><span class="s">&quot;agent_produccion@127.0.0.1&quot;</span><span class="p">,</span> <span class="s">&quot;secret&quot;</span><span class="p">)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

	<span class="n">s</span> <span class="o">=</span> <span class="n">AgentSanidad</span><span class="p">(</span><span class="s">&quot;agent_sanidad@127.0.0.1&quot;</span><span class="p">,</span> <span class="s">&quot;secret&quot;</span><span class="p">)</span>
	<span class="n">s</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

	<span class="n">a</span> <span class="o">=</span> <span class="n">AgentAlimentacion</span><span class="p">(</span><span class="s">&quot;agent_alimentacion@127.0.0.1&quot;</span><span class="p">,</span> <span class="s">&quot;secret&quot;</span><span class="p">)</span>
	<span class="n">a</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

	<span class="n">r</span> <span class="o">=</span> <span class="n">AgentReproduccion</span><span class="p">(</span><span class="s">&quot;agent_reproduccion@127.0.0.1&quot;</span><span class="p">,</span> <span class="s">&quot;secret&quot;</span><span class="p">)</span>
	<span class="n">r</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

	<span class="n">data</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="s">&#39;json&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>

	<span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">mimetype</span><span class="o">=</span><span class="s">&#39;application/json&#39;</span><span class="p">)</span></div>
</pre></div>

          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014, @mricharleon.
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../../_static/translations.js"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>